<ServiceDefinition name="TeleoptiCCC"
xmlns="http://schemas.microsoft.com/ServiceHosting/2008/10/ServiceDefinition">

  <WebRole name="TeleoptiCCC" vmsize="Standard_D2_v3">
    <Sites>
      <Site name="TeleoptiCCC" physicalDirectory="../../StartPage">
        <VirtualApplication name="SDK" physicalDirectory="../../SDK" />
        <VirtualApplication name="Analytics" physicalDirectory="../../Analytics" />
        <VirtualApplication name="Web" physicalDirectory="../../Web" />
        <VirtualApplication name="Client" physicalDirectory="../../Client" />
        <VirtualApplication name="RTA" physicalDirectory="../../Web" />
		<VirtualApplication name="AuthenticationBridge" physicalDirectory="../../AuthenticationBridge" />
		<VirtualApplication name="WindowsIdentityProvider" physicalDirectory="../../WindowsIdentityProvider" />
		<VirtualApplication name="Administration" physicalDirectory="../../Administration" />
		<VirtualApplication name="API" physicalDirectory="../../API" />
        <Bindings>
          <Binding name="HttpsIn" endpointName="HttpsIn" />
        </Bindings>
      </Site>
    </Sites>
    <Certificates>
      <Certificate name="fakedress.teleopticloud.com" storeLocation="LocalMachine" storeName="My"/>
    </Certificates>
    <Endpoints>
  		<InputEndpoint name="HttpsIn" protocol="https" port="443" certificate="fakedress.teleopticloud.com" />
		<InternalEndpoint name="Node1" protocol="http" port="14100" />
		<InternalEndpoint name="Node2" protocol="http" port="14101" />
		<InternalEndpoint name="Node3" protocol="http" port="14102" />
		<InternalEndpoint name="Node4" protocol="http" port="14103" />
    </Endpoints>
    <Imports>
		<Import moduleName="RemoteAccess" />
		<Import moduleName="RemoteForwarder" />
    </Imports>
    <LocalResources>
		<LocalStorage name="NETFXInstall" sizeInMB="1024" cleanOnRoleRecycle="false" />
	</LocalResources>    
    <Startup>
	  <Task commandLine="installNET.cmd" executionContext="elevated" taskType="simple">
		  <Environment>
		    <Variable name="PathToNETFXInstall">
			  <RoleInstanceValue xpath="/RoleEnvironment/CurrentInstance/LocalResources/LocalResource[@name='NETFXInstall']/@path" />
		    </Variable>
		    <Variable name="ComputeEmulatorRunning">
			  <RoleInstanceValue xpath="/RoleEnvironment/Deployment/@emulated" />
		    </Variable>
		  </Environment>
	  </Task>
	  <Task commandLine="InitHost.cmd" executionContext="elevated" taskType="simple" />
	  <Task commandLine="PatchDatabases.cmd" executionContext="elevated" taskType="simple" />
	  <Task commandLine="PrepareConfigAndSignClickOnce.cmd" executionContext="elevated" taskType="simple" />
	  <Task commandLine="InstallServiceV2.cmd" executionContext="elevated" taskType="simple" />
	  <Task commandLine="InitializeCopyPayroll.cmd" executionContext="elevated" taskType="simple" />
	  <Task commandLine="TLSHardening.cmd" executionContext="elevated" taskType="simple" />
	  <Task commandLine="CustomStartup.cmd" executionContext="elevated" taskType="simple" />

	</Startup>
	<Runtime executionContext="elevated">
	  <Environment>
		<Variable name="RoleStartupScripts" value="IIS7ConfigMoveToNET4.cmd!;Add-TeleoptiFoldersAndShortcuts.cmd!;InitializeServiceStarter.cmd!" >
		</Variable>
	  </Environment>
      <EntryPoint>
         <NetFxEntryPoint assemblyName="Tools\SupportTools\Teleopti.Support.Tool.exe" targetFrameworkVersion="v4.5"/>
      </EntryPoint>
    </Runtime>
	<ConfigurationSettings>
		<Setting name="TeleoptiDriveMap.BlobPath" />
		<Setting name="TeleoptiDriveMap.AccountName" />
		<Setting name="TeleoptiDriveMap.AccountKey" />
		<Setting name="TeleoptiDriveMap.ContainerName" />
		<Setting name="TeleoptiDriveMap.DataSourceName" />
		<Setting name="TeleoptiSetting.VmSize" />		
	</ConfigurationSettings>

  </WebRole>
</ServiceDefinition>
