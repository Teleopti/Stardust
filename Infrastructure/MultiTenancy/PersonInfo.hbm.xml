<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
                   assembly="Teleopti.Ccc.Infrastructure"
                   namespace="Teleopti.Ccc.Infrastructure.MultiTenancy"
                   default-access="field">
	<class name="PersonInfo" table="Person">
		<id name="Id" type="guid" access="property">
			<generator class="guid.comb" />
		</id>
		<property name="terminalDate" 
				type="Teleopti.Ccc.Infrastructure.NHibernateConfiguration.DateOnlyMappingType, Teleopti.Ccc.Infrastructure"
				not-null="false"/>
		<property name="isDeleted" />
		<join table="AuthenticationInfo" fetch="join" optional="true">
			<key column="Person" />
			<property column="[Identity]" name="identity" />
		</join>

		<join table="ApplicationAuthenticationInfo" fetch="join" optional="true">
			<key column="Person"/>
			<property name="applicationLogonName" />
			<property name="Password" access="property" />
		</join>
	</class>

	<query name="identityUserQuery">
		<![CDATA[
select p from PersonInfo p
where p.identity = :identity
and (p.terminalDate is null or p.terminalDate>getdate())
]]>
	</query>

	<query name="applicationUserQuery">
		<![CDATA[
select pi from PersonInfo pi
where pi.applicationLogonName=:userName
and (pi.terminalDate is null or pi.terminalDate>getdate())
]]>
	</query>
</hibernate-mapping>