<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
                   assembly="Teleopti.Ccc.Infrastructure"
                   namespace="Teleopti.Ccc.Infrastructure.MultiTenancy.Server">
	<class name="PersonInfo" table="Person" entity-name="PersonInfo_OldSchema" polymorphism="explicit">
		<id name="Id">
			<generator class="assigned" />
		</id>
		<property name="TerminalDate" 
							type="Teleopti.Ccc.Infrastructure.NHibernateConfiguration.DateOnlyMappingType, Teleopti.Ccc.Infrastructure"/>
		<many-to-one name="tenant" entity-name="Tenant_OldSchema" class="Tenant" access="field"/>
		
		<join table="AuthenticationInfo" fetch="join" optional="true">
			<key column="Person" />
			<property column="[Identity]" name="Identity"/>
		</join>

		<join table="ApplicationAuthenticationInfo" fetch="join" optional="true">
			<key column="Person"/>
			<property name="ApplicationLogonName" />
			<property name="Password" />
		</join>

		<join fetch="join" optional="true" table="UserDetail">
			<key column="Person"/>
			<component name="ApplicationLogonInfo" class="ApplicationLogonInfo">
				<parent name="PersonInfo" />
				<!--delete me soon!-->
				<property name="id" access="field"/>
				<property name="LastPasswordChange" />
				<property name="InvalidAttemptsSequenceStart" />
				<property name="InvalidAttempts" />
				<property name="IsLocked" />
			</component>
		</join>

	</class>

	<query name="identityUserQuery_OldSchema">
		<![CDATA[
select p from PersonInfo_OldSchema p
where p.Identity = :identity
and (p.TerminalDate is null or p.TerminalDate >= convert(date,getdate()))
]]>
	</query>

	<query name="applicationUserQuery_OldSchema">
		<![CDATA[
select pi from PersonInfo_OldSchema pi
where pi.ApplicationLogonName=:userName
and (pi.TerminalDate is null or pi.TerminalDate >= convert(date,getdate()))
]]>
	</query>
</hibernate-mapping>