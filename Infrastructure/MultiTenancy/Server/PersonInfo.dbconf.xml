<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
                   assembly="Teleopti.Ccc.Infrastructure"
                   namespace="Teleopti.Ccc.Infrastructure.MultiTenancy.Server"
									 schema="Tenant">
	<class name="PersonInfo">
		<id name="Id">
			<generator class="assigned" />
		</id>
		<many-to-one name="Tenant" class="Tenant"/>
		
		<property name="Identity" column="[Identity]"/>
		<property name="TenantPassword" />

		<component name="ApplicationLogonInfo" class="ApplicationLogonInfo">
			<property name="LogonName" column="ApplicationLogonName"/>
			<property name="LogonPassword" column="ApplicationLogonPassword"/>
			<property name="LastPasswordChange" />
			<property name="InvalidAttemptsSequenceStart" />
			<property name="InvalidAttempts" />
			<property name="IsLocked" />
		</component>
	</class>

	<query name="identityUserQuery">
		<![CDATA[
select p from PersonInfo p
where p.Identity = :identity
]]>
	</query>

	<query name="applicationUserQuery">
		<![CDATA[
select pi from PersonInfo pi
where pi.ApplicationLogonInfo.LogonName=:userName
]]>
	</query>

	<query name="findLogonInfo">
		<![CDATA[
select pi.Id as "PersonId", pi.ApplicationLogonInfo.LogonName as "LogonName", pi.Identity as "Identity"
from PersonInfo pi
where pi.Id in (:ids) and pi.Tenant=:tenant
]]>
	</query>

	<query name="findLogonInfoByLogonName">
		<![CDATA[
select pi.Id as "PersonId", pi.ApplicationLogonInfo.LogonName as "LogonName", pi.Identity as "Identity"
from PersonInfo pi
where pi.ApplicationLogonInfo.LogonName=:logonName and pi.Tenant=:tenant
]]>
	</query>

	<query name="findUserByCredentials">
		<![CDATA[
select p from PersonInfo p 
where p.Id=:id and p.TenantPassword=:tenantPassword
]]>
	</query>

	<query name="loadAll">
		select p from PersonInfo p
	</query>

	<query name="idUserQuery">
		<![CDATA[
select p from PersonInfo p
where p.Id = :id
]]>
	</query>
</hibernate-mapping>