<div class="person-schedule container">
	<div class="row">
		<!-- ko if: $root.Resources.MyTeam_MakeTeamScheduleConsistent_31897 -->
		<div class="col-md-3 input-group date pull-right" style="padding-right: 15px">
			<input type="text" data-bind="value: FormattedScheduleDate" readonly="readonly" class="start-date form-control" />
			<span class="input-group-btn">
				<span class="btn btn-navigation" enabled="false">
					<i class="glyphicon glyphicon-calendar"></i>
				</span>
			</span>
		</div>
		<!-- /ko -->
		<div class="col-md-12">
			<div class="relative">

				<!-- ko with: TimeLine -->
				<div class="time-line absolute" data-bind="attr: { 'data-start-time': StartTime, 'data-end-time': EndTime, 'data-minute-length': PixelsPerMinute, 'data-start-time-other-time-zone': StartTimeOtherTimeZone, 'data-end-time-other-time-zone': EndTimeOtherTimeZone, }">
					<div class="relative">
						<div data-bind="foreach: Times">
							<div class="ruler absolute" data-bind="style: { left: Pixel() + 'px' }"></div>
							<div class="label label-info absolute" data-bind="style: { left: (Pixel() - 13) + 'px' }, text: Time"></div>
							<!-- ko if: $parent.IsOtherTimeZone -->
							<div class="ruler absolute" data-bind="style: { left: Pixel() + 'px' }"></div>
							<div class="label label-info absolute other-time-zone-label" data-bind="style: { left: (Pixel() - 13) + 'px' }, text: TimeOtherTimeZone"></div>
							<!-- /ko -->
						</div>
					</div>
				</div>
				<!-- /ko -->

				<table class="table table-hover">
					<thead>
						<tr>
							<th></th>
							<th></th>
						</tr>
					</thead>

					<tbody>
						<tr class="person selected-person" data-bind="attr: { 'data-person-id': PersonId }, css:{'time-zone-style': IsOtherTimeZone}">
							<td class="person-name person-name-column">
								<!-- ko if: IsOtherTimeZone -->
								<div class="other-time-zone-name-div">
									<i class="glyphicon glyphicon-globe"></i>
									<span class="small other-time-zone-short" data-bind="text: TimeZoneNameShort"></span>
								</div>
								<!-- /ko -->
								<div class="person-name nowrap" data-bind="text: Name"></div>
							</td>
							<td class="schedule schedule-column">
								<div class="relative time-line-for">
									<!-- ko foreach: Shifts -->
									<div class="shift" data-bind="
		template: {
				name: 'layerTemplate',
				foreach: Layers
		}">
									</div>
									<!-- /ko -->
									<!-- ko if: IsDayOff -->
									<!-- ko with: DayOff -->
									<!-- ko if: OverlapsTimeLine -->
									<div class="dayoff absolute" data-bind="style: { left: StartPixels() + 'px', width: LengthPixels() + 'px', top: $parent.IsOtherTimeZone() ? '13px' : '-8px' }"></div>
									<!-- /ko -->
									<!-- /ko -->
									<!-- /ko -->
								</div>
							</td>
						</tr>

						<tr class="form-placeholder" data-bind="if: DisplayForm">
							<td class="person-name-column"></td>
							<td class="schedule-column edit-column">
								<table>
									<tr>
										<td>
											<!-- ko if: $root.AddingIntradayAbsence -->
											<!-- ko with: $root.AddIntradayAbsenceForm -->
											<form action="#" class="intraday-absence-form">
												<table class="edit-area">
													<tr>
														<td class="col-md-3 edit-time-column">
															<select class="absence-type input-sm form-control" data-bind="disable: $root.Loading, options: AbsenceTypes, optionsText: 'Name', optionsValue: 'Id', value: Absence"></select>
														</td>
														<td class="other-time-zone">
															<div data-bind="visible:IsOtherTimezone">
																<i class="glyphicon glyphicon-globe"></i>
																<span data-bind="html: TimeZoneName"></span>
															</div>
														</td>
													</tr>
													<tr>
														<td class="col-md-3 edit-time-column">
															<div class="bootstrap-timepicker">
																<div class="input-group">
																	<span class="input-group-addon"><i class="glyphicon glyphicon-step-backward"></i></span>
																	<input type="text" class="start-time form-control" data-bind="timepicker: StartTime, timepickerOptions: { showMeridian: $root.Resources.ShowMeridian, allowEmpty: true }" />
																	<span class="input-group-addon"><i class="glyphicon glyphicon-time"></i></span>
																</div>
															</div>
														</td>
														<td class="other-start-time">
															<div data-bind="visible:IsOtherTimezone">
																<i class="glyphicon glyphicon-step-backward"></i>
																<span data-bind="html: StartTimeOtherTimeZone"></span>
															</div>
														</td>
													</tr>
													<tr>
														<td class="col-md-3 edit-time-column">
															<div class="bootstrap-timepicker">
																<div class="input-group">
																	<span class="input-group-addon"><i class="glyphicon glyphicon-step-forward"></i></span>
																	<input type="text" class="end-time form-control" data-bind="timepicker: EndTime, timepickerOptions: { showMeridian: $root.Resources.ShowMeridian, allowEmpty: true }" />
																	<span class="input-group-addon"><i class="glyphicon glyphicon-time"></i></span>
																</div>
															</div>
														</td>
														<td class="other-end-time">
															<div data-bind="visible:IsOtherTimezone">
																<i class="glyphicon glyphicon-step-forward"></i>
																<span data-bind="html: EndTimeOtherTimeZone"></span>
															</div>
														</td>
													</tr>
													<tr>
														<td class="col-md-3" colspan="2">
															<!-- ko if: ErrorMessage -->
															<div class="alert">
																<span data-bind="text: ErrorMessage"></span>
															</div>
															<!-- /ko -->
															<div>
																<!-- ko if: $root.Resources.MyTeam_MakeTeamScheduleConsistent_31897 -->
																<button class="btn btn-default cancel" data-bind="text: $root.Resources.Cancel, click: $root.backToTeamSchedule"></button>
																<!-- /ko -->
																<button class="btn btn-primary apply" data-bind="disable: $root.Loading() || ErrorMessage(), text: $root.Resources.AddIntradayAbsence, click: Apply"></button>
															</div>
														</td>
													</tr>
												</table>
											</form>
											<!-- /ko -->
											<!-- /ko -->
											<!-- ko if: $root.AddingActivity -->
											<!-- ko with: $root.AddActivityForm -->
											<form action="#" class="activity-form">
												<table class="edit-area">
													<tr>
														<td class="col-md-3 edit-time-column">
															<select class="activity-type input-sm form-control" data-bind="disable: $root.Loading, options: ActivityTypes, optionsText: 'Name', optionsValue: 'Id', value: Activity"></select>
														</td>
														<td class="other-time-zone">
															<div data-bind="visible:IsOtherTimezone">
																<i class="glyphicon glyphicon-globe"></i>
																<span data-bind="html: TimeZoneName"></span>
															</div>
														</td>
													</tr>
													<tr>
														<td class="col-md-3 edit-time-column">
															<div class="bootstrap-timepicker">
																<div class="input-group">
																	<span class="input-group-addon"><i class="glyphicon glyphicon-step-backward"></i></span>
																	<input type="text" class="start-time form-control" data-bind="timepicker: StartTime, timepickerOptions: { showMeridian: $root.Resources.ShowMeridian, allowEmpty: true }" />
																	<span class="input-group-addon"><i class="glyphicon glyphicon-time"></i></span>
																</div>
															</div>
														</td>
														<td class="other-start-time">
															<div data-bind="visible:IsOtherTimezone">
																<i class="glyphicon glyphicon-step-backward"></i>
																<span data-bind="html: StartTimeOtherTimeZone"></span>
															</div>
														</td>
													</tr>
													<tr>
														<td class="col-md-3 edit-time-column">
															<div class="bootstrap-timepicker">
																<div class="input-group">
																	<span class="input-group-addon"><i class="glyphicon glyphicon-step-forward"></i></span>
																	<input type="text" class="end-time form-control" data-bind="timepicker: EndTime, timepickerOptions: { showMeridian: $root.Resources.ShowMeridian, allowEmpty: true }" />
																	<span class="input-group-addon"><i class="glyphicon glyphicon-time"></i></span>
																</div>
															</div>
														</td>
														<td class="other-end-time">
															<div data-bind="visible:IsOtherTimezone">
																<i class="glyphicon glyphicon-step-forward"></i>
																<span data-bind="html: EndTimeOtherTimeZone"></span>
															</div>
														</td>
													</tr>
													<tr>
														<td class="col-md-6">
															<!-- ko if: ErrorMessage -->
															<div class="alert">
																<span data-bind="text: ErrorMessage"></span>
															</div>
															<!-- /ko -->
															<div>
																<!-- ko if: $root.Resources.MyTeam_MakeTeamScheduleConsistent_31897 -->
																<button class="btn btn-default cancel" data-bind="text: $root.Resources.Cancel, click: $root.backToTeamSchedule"></button>
																<!-- /ko -->
																<button class="btn btn-primary apply" data-bind="disable: $root.Loading() || ErrorMessage(), text: $root.Resources.AddActivity, click: Apply"></button>
															</div>
														</td>
														<td></td>
													</tr>
												</table>
											</form>
											<!-- /ko -->
											<!-- /ko -->
											<!-- ko if: $root.MovingActivity -->
											<!-- ko with: $root.MoveActivityForm -->
											<form action="#" class="activity-form">
												<table class="edit-area">
													<tr>
														<td class="col-md-3 edit-time-column"></td>
														<td class="other-time-zone">
															<div data-bind="visible:IsOtherTimezone">
																<i class="glyphicon glyphicon-globe"></i>
																<span data-bind="html: TimeZoneName"></span>
															</div>
														</td>
													</tr>
													<tr>
														<td class="col-md-3 edit-time-column">
															<div class="bootstrap-timepicker">
																<div class="input-group">
																	<span class="input-group-addon"><i class="glyphicon glyphicon-step-backward"></i></span>
																	<input type="text" class="start-time form-control" data-bind="timepicker: DisplayedStartTime, timepickerOptions: { showMeridian: $root.Resources.ShowMeridian, allowEmpty: true }" />
																	<span class="input-group-addon"><i class="glyphicon glyphicon-time"></i></span>
																</div>
															</div>
														</td>
														<td class="other-start-time">
															<div data-bind="visible:IsOtherTimezone">
																<i class="glyphicon glyphicon-step-backward"></i>
																<span data-bind="html: StartTimeOtherTimeZone"></span>
															</div>
														</td>
													</tr>

													<tr>
														<td class="col-md-3">
															<!-- ko if: ErrorMessage -->
															<div class="alert">
																<span data-bind="text: ErrorMessage"></span>
															</div>
															<!-- /ko -->
															<div>
																<button class="btn btn-default cancel" data-bind="text: $root.Resources.Cancel, click: $root.backToTeamSchedule"></button>
																<button class="btn btn-primary apply" data-bind="disable: $root.Loading() || ErrorMessage() || !formHasChanged(), text: $root.Resources.MoveActivity, click: Apply"></button>
															</div>
														</td>
														<td></td>
													</tr>
												</table>
											</form>
											<!-- /ko -->
											<!-- /ko -->
											<!-- ko if: $root.AddingFullDayAbsence -->
											<!-- ko with: $root.AddFullDayAbsenceForm -->
											<form action="#" class="full-day-absence-form">
												<table class="edit-area">
													<tr>
														<td class="col-md-5 edit-time-column">
															<select id="absence-type" class="absence-type input-sm form-control" data-bind="disable: $root.Loading, options: AbsenceTypes, optionsText: 'Name', optionsValue: 'Id', value: AbsenceType"></select>
														</td>
													</tr>
													<tr>
														<td class="col-md-5 edit-time-column">
															<div class="input-group">
																<span class="input-group-addon">
																	<i class="glyphicon glyphicon-step-backward"></i>
																</span>
																<input type="text" class="start-date form-control" readonly="readonly" data-bind="value: StartDateFormatted" />
															</div>
														</td>
													</tr>
													<tr>
														<td class="col-md-5 edit-time-column">
															<div class="input-group">
																<span class="input-group-addon">
																	<i class="glyphicon glyphicon-step-forward"></i>
																</span>
																<input type="text" class="end-date form-control" readonly="readonly" data-bind="value: EndDateFormatted" />
																<div class="date input-group-btn">
																	<button class="btn" data-bind="datepicker: EndDate, datepickerOptions: { format: $root.Resources.DateFormatForMoment, weekStart: $root.Resources.FirstDayOfWeek, autoclose: true }">
																		<i class="glyphicon glyphicon-calendar"></i>
																	</button>
																</div>
															</div>
														</td>
													</tr>

													<tr>
														<td class="col-md-5">
															<!-- ko if: InvalidEndDate -->
															<div class="alert">
																<span data-bind="text: $root.Resources.InvalidEndDate"></span>
															</div>
															<!-- /ko -->
															<div>
																<!-- ko if: $root.Resources.MyTeam_MakeTeamScheduleConsistent_31897 -->
                                                                <button class="btn btn-default cancel" data-bind="disable: $root.Loading, text: $root.Resources.Cancel, click: $root.backToTeamSchedule"></button>
																<!-- /ko -->
																<button class="btn btn-primary apply" data-bind="disable: InvalidEndDate() || $root.Loading(), text: $root.Resources.AddFullDayAbsence, click: Apply"></button>
															</div>
														</td>
														<td></td>
													</tr>
												</table>
											</form>
											<!-- /ko -->
											<!-- /ko -->
										</td>
									</tr>
								</table>
							</td>
						</tr>

						<tr class="form-placeholder" data-bind="ifnot: DisplayForm">
							<td class="person-name-column"></td>
							<td class="schedule-column edit-column">
								<div class="row">
									<div class="col-md-8">
										<!-- ko if: !Loading() && Absences().length == 0 -->
										<div class="alert alert-warning" data-bind="text: $root.Resources.NoAbsenceToRemoveInCurrentShift"></div>
										<!-- /ko -->
										<table class="absence-list">
											<tbody data-bind="foreach: Absences">
												<tr class="absence">
													<td>
														<table class="table">
															<tr class="absence-detail absence-user-timezone">
																<td class="absence-item" data-bind="style: { backgroundColor: BackgroundColor }">
																<td class="absence-item">
																	<span class="absence-name" data-bind="text: Name"></span>
																</td>
																<td class="absence-item">
																	<i class="glyphicon glyphicon-step-backward"></i>
																	<span data-bind="text: StartDateTime"></span>
																</td>
																<td class="absence-item">
																	<i class="glyphicon glyphicon-minus"></i>
																</td>
																<td class="absence-item">
																	<span data-bind="text: EndDateTime"></span>
																	<i class="glyphicon glyphicon-step-forward"></i>
																</td>
																<td class="absence-item" rowspan="2">
																	<!-- ko ifnot: AboutToRemove -->
																	<button class="btn remove" data-bind="click: Remove, text: $root.Resources.Remove" />
																	<!-- /ko -->
																	<!-- ko if: AboutToRemove -->
																	<button class="btn btn-danger confirm-removal" data-bind="disable: Removing, click: ConfirmRemoval, text: $root.Resources.ConfirmRemoval" />
																	<!-- /ko -->
																</td>
																<td class="absence-item" rowspan="2">
																	<button class="btn btn-primary back-to-work" data-bind="click: ShowBackToWorkSection, text: $root.Resources.AbsenceBackToWork" />
																</td>
															</tr>
															<tr class="absence-detail absence-other-timezone" data-bind="visible:IsOtherTimezone">
																<td class="absence-item" data-bind="style: { backgroundColor: BackgroundColor }">
																<td class="absence-item other-time-zone-short">
																	<i class="glyphicon glyphicon-globe"></i>
																	<span data-bind="text: TimeZoneNameShort"></span>
																</td>
																<td class="absence-item">
																	<i class="glyphicon glyphicon-step-backward"></i>
																	<span data-bind="text: StartTimeOtherTimeZone"></span>
																</td>
																<td class="absence-item">
																	<i class="glyphicon glyphicon-minus"></i>
																</td>
																<td class="absence-item">
																	<span data-bind="text: EndTimeOtherTimeZone"></span>
																	<i class="glyphicon glyphicon-step-forward"></i>
																</td>
															</tr>
														</table>
														<div class="back-to-work-form" data-bind="visible:IsBackToWorkFormVisible">
															<div class="row form-group">
																<div class="col-xs-8">
																	<div data-bind="text: BackToWorkTextPrompt"></div>
																</div>
															</div>
															<div class="row form-group">
																<div class="col-xs-4">
																	<div class="input-group">
																		<span class="input-group-btn">
																			<button class="btn btn-sm">
																				<i class="glyphicon glyphicon-step-forward"></i>
																			</button>
																		</span>
																		<input type="text" class="input-sm date-input form-control" readonly="readonly" data-bind="value : CurrentDate" />
																		<span class="input-group-btn">
																			<button class="btn btn-sm" data-bind="datepicker: CurrentDateMoment, datepickerOptions: { format: $root.Resources.DateFormatForMoment, weekStart: $root.Resources.FirstDayOfWeek, autoclose: true }">
																				<i class="glyphicon glyphicon-calendar"></i>
																			</button>
																		</span>
																	</div>
																</div>
															</div>
															<div class="row form-group" data-bind="visible:IsOtherTimezone">
																<div class="col-xs-4 timeZoneText">
																	<i class="glyphicon glyphicon-globe"></i>
																	<span data-bind="text: TimeZoneNameShort"></span>
																</div>
																<div class="col-xs-4 timeZoneText">
																	<span data-bind="text: ModifiedEndTimeOtherTimeZone"></span>
																	<i class="glyphicon glyphicon-step-forward"></i>
																</div>
															</div>
															<!-- ko if: ErrorMessage -->
															<div class="alert">
																<span data-bind="text: ErrorMessage"></span>
															</div>
															<!-- /ko -->
															<div class="row form-group">
																<div class="col-xs-8">
																	<button class="btn btn-default cancel" data-bind="click: $root.backToTeamSchedule, text: $root.Resources.Cancel"></button>
																	<button class="btn btn-primary save-absence" data-bind="click: Save, text: $root.Resources.Save, enable: IsAbsenceValid"></button>
																</div>
															</div>
														</div>
													</td>
												</tr>
											</tbody>
										</table>
										<div>
											<!-- ko if: $root.Resources.MyTeam_MakeTeamScheduleConsistent_31897 -->
											<button class="btn btn-default cancel" data-bind="text: $root.Resources.Cancel, click: $root.backToTeamSchedule"></button>
											<!-- /ko -->
										</div>
									</div>
									<div class="col-md-4"></div>
								</div>
							</td>
						</tr>

						<!-- ko ifnot: Loading -->
						<!-- ko foreach: SortedPersons -->
						<tr class="person" data-bind="attr: { 'data-person-id': Id }, if: $parent.PersonId() != Id">
							<td class="person-name person-name-column">
								<div class="person-name nowrap" data-bind="text: Name"></div>
							</td>
							<td class="schedule schedule-column" style="padding-top: 4px">
								<div class="relative time-line-for">
									<!-- ko foreach: Shifts -->
									<div class="shift" data-bind="template: {name: 'layerTemplate', foreach: Layers}"></div>
									<!-- /ko -->
									<!-- ko foreach: DayOffs -->
									<!-- ko if: OverlapsTimeLine -->
									<div class="dayoff absolute"
										 data-bind="style: { left: StartPixels() + 'px', width: LengthPixels() + 'px' }">
									</div>
									<!-- /ko -->
									<!-- /ko -->
								</div>
							</td>
						</tr>
						<!-- /ko -->
						<!-- /ko -->
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

<script id="layerTemplate" type="text/html">
	<!-- ko if: OverlapsTimeLine -->
	<div class="layer absolute floatleft" data-bind="
		style: {
				left: StartPixels() + 'px',
				width: LengthPixels() + 'px',
				backgroundColor: Color
		},
		attr: {
				'data-start-time': StartTime,
				'data-length-minutes': LengthMinutes()
		},
		css: Active,
		click: function () {
        return $root.SelectLayer($data, $parents );
		}
		">
	</div>
	<!-- /ko -->
</script>
