<div class="container team-schedule">
	<table class="table table-condensed well well-small" data-bind="visible: DisplayStaffingMetrics">
		<thead>
			<tr>
				<th>
					<span id="skill-selector" class="btn-group">
						<a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
							<span data-bind="text: SelectedSkillName"></span>
							<span class="caret"></span>
						</a>
						<ul class="dropdown-menu" data-bind="foreach: { data: Skills, as: 'skill' }">
							<li>
								<a data-bind="text: skill.Name, value: skill.Id, click: $parent.SelectSkill"></a>
							</li>
						</ul>
					</span>
				</th>
				<th data-bind="visible: LoadingStaffingMetrics"><span class="" data-bind="	text: Resources.LoadingThreeDots"></span></th>
				<th><span id="forecasted-hours" data-bind="visible: !LoadingStaffingMetrics(), text: ForecastedHoursDisplay"></span></th>
				<th><span id="scheduled-hours" data-bind="visible: !LoadingStaffingMetrics(), text: ScheduledHoursDisplay"></span></th>
				<th><span id="difference-forecasted-scheduled" class="text-error" data-bind="visible: !LoadingStaffingMetrics(), text: DifferenceDisplay"></span></th>
				<th><span id="estimated-service-level" class="text-warning" data-bind="visible: !LoadingStaffingMetrics(), text: ESLDisplay"></span></th>
			</tr>
		</thead>
	</table>

	<div class="row">
		<div class="span12">
			<form>
				<div class="control-group">
					<select id="group-picker" class="span4" data-bind="enable: !Loading(), foreach: GroupPages, select2: { value: GroupId } ">
						<optgroup data-bind="attr: { label: Name }, foreach: Groups">
							<option data-bind="text: Name, value: Id"></option>
						</optgroup>
					</select>
					<div class="pull-right">
						<div class="input-append date input-prepend" id="date-picker" data-bind="datepicker: Date, datepickerOptions: { pullRight: true, format: Resources.MomentShortDatePattern, weekStart: Resources.FirstDayOfWeek, autoclose: true }">

							<button class="btn" data-bind="attr: { title: Resources.Previous }, click: PreviousDay"><i class="icon-chevron-left"></i></button>
							<input class="add-on date-input" size="16" type="text" readonly="readonly" />
							<span class="add-on"><i class="icon-calendar"></i></span>
							<button class="btn" data-bind="attr: { title: Resources.Next }, click: NextDay"><i class="icon-chevron-right"></i></button>
						</div>
						<div class="input-append">
							<button class="btn toggle-descriptions" data-toggle="button" disabled data-bind="enable: !Loading(), click: ToggleDisplayDescriptions"><i class="icon-question-sign"></i></button>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>

	<div class="row">
		<div class="span12">
			<!-- ko if: Loading -->
			<div><span data-bind="text: Resources.LoadingThreeDots"></span></div>
			<!-- /ko -->
			<!-- ko if: !Loading() -->
			<div class="relative">
				<!-- ko with: TimeLine -->
				<div class="time-line absolute" data-bind="attr: { 'data-start-time': StartTime, 'data-end-time': EndTime }, if: $parent.Persons().length>0">
					<div class="relative">
						<div data-bind="foreach: Times">
							<div class="ruler absolute" data-bind="style: { left: Pixel() + 'px' }"></div>
							<div class="label label-info absolute" data-bind="style: { left: (Pixel() - 13) + 'px' }, text: Time"></div>
						</div>
					</div>
				</div>
				<!-- /ko -->

				<table class="table table-hover" data-bind="if: Persons().length > 0">
					<thead>
						<tr>
							<th></th>
							<th></th>
							<th class="contract-time contract-time-title"><span data-bind="text: Resources.ContractTime"></span></th>
						</tr>
					</thead>
					<tbody data-bind="foreach: Persons">
						<tr class="person" data-bind="attr: { 'data-person-id': Id }, css: { 'selected-person': IsPersonOrShiftSelected }">
							<td class="person-name person-name-column">
								<div class="person-name nowrap" data-bind="text: Name, click: $root.SelectPerson"></div>
							</td>
							<td class="schedule schedule-column" data-bind="click: $root.SelectPerson">
								<div class="relative time-line-for">
									<!-- ko foreach: Shifts -->
									<div class="shift" data-bind="
									template: {
										name: 'layerTemplate',
										foreach: Layers
									}
									"></div>
									<!-- /ko -->

									<!-- ko foreach: DayOffs -->
									<!-- ko if: OverlapsTimeLine -->
									<div
										class="dayoff absolute"
										data-bind="style: { left: StartPixels() + 'px', width: LengthPixels() + 'px' }">
										<!-- ko if: $root.DisplayDescriptions -->
										<!-- ko if: HasOverlapingLayers($parent)-->
										<span class="label layer-description floatleft" data-bind="text: DayOffName"></span>
										<span class="label layer-description floatright" data-bind="text: DayOffName"></span>
										<!-- /ko -->
										<!-- ko ifnot: HasOverlapingLayers($parent)-->
										<span class="label layer-description" data-bind="text: DayOffName"></span>
										<!-- /ko -->
										<!-- /ko -->
									</div>
									<!-- /ko -->
									<!-- /ko -->
								</div>
							</td>
							<td class="contract-time contract-time-column" data-bind="text: ContractTime"></td>
						</tr>
						
						<!-- ko foreach: Shifts -->
						<!-- ko foreach: Layers -->
						<!-- ko if: Selected -->
						<tr class="shift-menu">
							<td class="person-name-column"></td>
							<td class="schedule-column" colspan="2">
								<div class="activity-details" data-bind="style: { 'margin-left': StartPixels() + 'px' }">
									<p>
										<span class="label" data-bind="style: { 'background-color': Color, 'color': TextColor }, text: Description + ' ' + StartTime() + ' - ' + EndTime()"></span>
									</p>
								</div>

								<div class="shift-details" data-bind="if: $root.DisplayDescriptions, style: { 'margin-left': $parent.ShiftStartPixels() + 'px' }">
									<!-- ko foreach: $parent.DistinctLayers -->
									<span class="label" data-bind="style: { 'background-color': Color, 'color': TextColor }, text: Description"></span>
									<!-- /ko -->
								</div>
								
								<div class="shift-menu" data-bind="style: { 'margin-left': $parent.ShiftStartPixels() + 'px' }">
									<!-- ko with: $parent.ShiftMenu -->
									<div class="btn-group">
										<a href="#" class="btn btn-small add-full-day-absence" data-bind="click: $data.AddFullDayAbsence"><i class="icon-plus"></i><span data-bind="	text: $root.Resources.FullDayAbsence"></span></a>
										<a href="#" class="btn btn-small add-intraday-absence" data-bind="click: $data.AddIntradayAbsence"><i class="icon-plus"></i><span data-bind="	text: $root.Resources.IntradayAbsence"></span></a>
										<!-- ko if: false -->
											<a href="#" class="btn btn-small add-activity" data-bind="click: $data.AddActivity"><i class="icon-plus"></i><span data-bind="	text: $root.Resources.Activity"></span></a>
										<!-- /ko -->
										<a href="#" class="btn btn-small remove-absence" data-bind="click: $data.RemoveAbsence"><i class="icon-minus"></i><span data-bind="	text: $root.Resources.Absence"></span></a>
									</div>
									<!-- /ko -->
								</div>
							</td>
						</tr>
						<!-- /ko -->
						<!-- /ko -->
						<!-- /ko -->
						
						<!-- ko if: Selected -->
						<tr class="person-menu">
							<td class="person-name-column"></td>
							<td class="schedule-column" colspan="2">
								<div class="schedule-menu">
									<!-- ko with: Menu -->
									<div class="btn-group">
										<a href="#" class="btn btn-small add-full-day-absence" data-bind="click: $data.AddFullDayAbsence"><i class="icon-plus"></i><span data-bind="	text: $root.Resources.FullDayAbsence"></span></a>
									</div>
									<!-- /ko -->
								</div>
							</td>
						</tr>
						<!-- /ko -->
						
					</tbody>
				</table>
			</div>
			<!-- /ko -->
		</div>
	</div>
</div>

<script id="layerTemplate" type="text/html">
	<!-- ko if: OverlapsTimeLine -->
	<div class="layer absolute floatleft" data-bind="
	style: {
		left: StartPixels() + 'px',
		width: LengthPixels() + 'px',
		backgroundColor: Color
	},
	attr: {
		'data-start-time': StartTime,
		'data-length-minutes': LengthMinutes(),
	},
	click: function () {
		return $root.SelectLayer($data, $parent.PersonId);
	},
	clickBubble: false
	">
		<!-- ko if: IsFullDayAbsence && $parent.Layers().length == 1 -->
		<!-- ko if: $root.DisplayDescriptions -->
		<span class="label layer-description" data-bind="text: Description"></span>
		<!-- /ko -->
		<!-- /ko -->
	</div>
	<!-- /ko -->
</script>
