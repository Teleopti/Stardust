<div class="container team-schedule">
	<div class="row">
		<div id="existsWhenLoadingFinishes" data-bind="ifnot: Loading"></div>
		<a class="col-md-12 btn pull-right" style="background: #bada55; text-align: left; color: #333 !important; text-decoration: none !important; margin-bottom: 10px;" data-bind="{ text: TryOutTheNewImprovedTeams, attr: { href: URLPath}}"></a>
        <div class="col-xs-12 col-md-4">
            <select id="group-picker" class="col-xs-12" data-bind="disable: Loading, foreach: GroupPages, select2: { value: GroupId } ">
                <optgroup data-bind="attr: { label: Name }, foreach: Groups" label="Missing">
                    <option data-bind="text: Name, value: Id"></option>
                </optgroup>
            </select>
        </div>
		<div class="col-xs-12 col-md-4 pull-right">
			<div class="btn-group">
				<div class="input-group date" id="date-picker">
					<span class="input-group-btn">
						<button class="btn btn-navigation" data-bind="attr: { title: Resources.Previous }, click: PreviousDay">
							<i class="glyphicon glyphicon-chevron-left"></i>
						</button>
					</span>
					<input class="form-control date-input text-center" size="16" type="text" readonly="readonly" data-bind="value: DateFormatted" />
					<span class="input-group-btn">
						<button type="button" class="btn btn-navigation" data-bind="datepicker: Date, datepickerOptions: { pullRight: true, format: Resources.MomentShortDatePattern, weekStart: Resources.FirstDayOfWeek, autoclose: true }">
							<i class="glyphicon glyphicon-calendar"></i>
						</button>
						<button class="btn btn-navigation" data-bind="attr: { title: Resources.Next }, click: NextDay">
							<i class="glyphicon glyphicon-chevron-right"></i>
						</button>
						<button class="btn btn-navigation toggle-descriptions" data-toggle="button" disabled data-bind="disable: Loading, click: ToggleDisplayDescriptions">
							<i class="glyphicon glyphicon-info-sign"></i>
						</button>
					</span>
				</div>
			</div>
		</div>
    </div>
	
	<div class="row">
        <div class="col-md-12">
            <!-- ko if: Loading -->
            <div><span data-bind="text: Resources.LoadingThreeDots"></span></div>
			<!-- /ko -->
			
			<!-- ko ifnot: Loading-->

				<!-- ko ifnot: HasGroupPages -->
				<div class="alert alert-warning">
					<span data-bind="text: Resources.NoHierarchiesExist"></span>
				</div>
				<!-- /ko -->
			
				<!-- ko if: HasGroupPages  -->
				<div class="relative">
					<!-- ko with: TimeLine -->
					<div class="time-line absolute" data-bind="attr: { 'data-start-time': StartTime, 'data-end-time': EndTime }, if: $parent.SortedPersons().length > 0">
						<div class="relative">
							<div data-bind="foreach: Times">
								<div class="ruler absolute" data-bind="style: { left: Pixel() + 'px' }"></div>
								<div class="label label-info absolute" data-bind="style: { left: (Pixel() - 13) + 'px' }, text: Time"></div>
							</div>
						</div>
					</div>
					<!-- /ko -->

					<table class="table table-hover">
						<thead>
							<tr class="person">
								<th class="person-name person-name-column"></th>
								<th class="schedule schedule-column"></th>
								<th class="contract-time contract-time-title"><span data-bind="text: Resources.ContractTime"></span></th>
							</tr>
						</thead>
						<tbody data-bind="foreach: SortedPersons">
							<tr class="person" data-bind="attr: { 'data-person-id': Id }, css: { 'selected-person': IsPersonOrShiftSelected }, click: $root.SelectPerson">
								<td class="person-name person-name-column">
									<div class="person-name nowrap" data-bind="text: Name"></div>
								</td>
								<td class="schedule schedule-column">
									<div class="relative time-line-for">
										<!-- ko foreach: Shifts -->
										<div class="shift" data-bind="
		template: {
			name: 'layerTemplate',
			foreach: Layers
		}
										">
										</div>
										<!-- /ko -->

										<!-- ko foreach: DayOffs -->
										<!-- ko if: OverlapsTimeLine -->
										<div
											class="dayoff absolute"
											data-bind="style: { left: StartPixels() + 'px', width: LengthPixels() + 'px'}">
											<!-- ko if: $root.DisplayDescriptions -->
											<!-- ko if: HasOverlapingLayers($parent)-->
											<span class="label label-default layer-description floatleft" data-bind="text: DayOffName"></span>
											<span class="label label-default layer-description floatright" data-bind="text: DayOffName"></span>
											<!-- /ko -->
											<!-- ko ifnot: HasOverlapingLayers($parent)-->
											<span class="label label-default layer-description" data-bind="text: DayOffName"></span>
											<!-- /ko -->
											<!-- /ko -->
										</div>
										<!-- /ko -->
										<!-- /ko -->
									</div>
								</td>
								<td class="contract-time contract-time-column" data-bind="text: ContractTime"></td>
							</tr>

							<!-- ko foreach: Shifts -->
							<!-- ko foreach: Layers -->
							<!-- ko if: Selected -->
							<tr class="shift-menu">
								<td class="person-name-column"></td>
								<td class="schedule-column" colspan="2">
									<div class="activity-details" data-bind="style: { 'margin-left': StartPixels() + 'px' }">
										<p>
											<span class="label label-default" data-bind="style: { 'background-color': Color, 'color': TextColor }, text: Description + ' ' + StartTime() + ' - ' + EndTime()"></span>
										</p>
									</div>
								
									<!-- ko if: $root.DisplayDescriptions -->
									<div class="shift-details" data-bind="style: { 'margin-left': $parent.ShiftStartPixels() + 'px' }">
										<!-- ko foreach: $parent.DistinctLayers -->
										<span class="label label-default" data-bind="style: { 'background-color': Color, 'color': TextColor }, text: Description"></span>
										<!-- /ko -->
									</div>
									<!-- /ko -->
								</td>
							</tr>
							<!-- /ko -->
							<!-- /ko -->
							<!-- /ko -->

							<!-- ko if: Selected -->
							<tr class="person-menu">
								<td class="person-name-column-menu" data-bind="text: Name"></td>
								<td class="schedule-column" colspan="2">
									<div class="schedule-menu">
										<!-- ko with: Menu -->
										<div class="btn-group">
											<!-- ko if: $root.permissionAddFullDayAbsence -->
											<a class="btn btn-sm add-full-day-absence" data-bind="attr: { href: $data.urlForAddFullDayAbsence()}"><i class="glyphicon glyphicon-plus"></i><span data-bind="    text: $root.Resources.FullDayAbsence"></span></a>
											<!-- /ko -->
											<!-- ko if: $root.permissionAddIntradayAbsence -->
											<a class="btn btn-sm add-intraday-absence" data-bind="attr: { href: $data.urlForAddIntradayAbsence()}"><i class="glyphicon glyphicon-plus"></i><span data-bind="    text: $root.Resources.IntradayAbsence"></span></a>
											<!-- /ko-->
											<!-- ko if: $root.permissionAddActivity -->
											<a class="btn btn-sm add-activity" data-bind="attr: { href: $data.urlForAddActivity()}"><i class="glyphicon glyphicon-plus"></i><span data-bind="    text: $root.Resources.Activity"></span></a>
											<!-- /ko -->
											<!-- ko if: $root.permissionRemoveAbsence -->
											<a class="btn btn-sm remove-absence" data-bind="attr: { href: $data.urlForRemoveAbsence()}"><i class="glyphicon glyphicon-minus"></i><span data-bind="    text: $root.Resources.Absence"></span></a>
											<!-- /ko-->
											<!-- ko if: $root.HasPermissionForMovingActivity -->
											<!-- ko if: $parent.IsMoveActivityVisible -->
											<a class="btn btn-sm move-activity " data-bind="attr: { href: $data.urlForMoveActivity($parent)}"><i class="glyphicon glyphicon-hand-up"></i><span data-bind="    text: $root.Resources.MoveActivity"></span></a>
											<!-- /ko-->
											<!-- /ko-->
										</div>
										<!-- /ko -->
									</div>
								</td>
							</tr>
							<!-- /ko -->

						</tbody>
					</table>
				</div>
				<!-- /ko -->
			<!-- /ko -->
        </div>
    </div>
</div>

<script id="layerTemplate" type="text/html">
	<!-- ko if: OverlapsTimeLine -->
	<div class="layer absolute floatleft" data-bind="
    style: {
        left: StartPixels() + 'px',
        width: LengthPixels() + 'px',
        backgroundColor: Color
    },
    attr: {
        'data-start-time': StartTime,
        'data-length-minutes': LengthMinutes(),
    },
    click: function () {
        return $root.SelectLayer($data, $parent);
    },
    clickBubble: false
	">
		<!-- ko if: IsFullDayAbsence && $parent.Layers().length == 1 -->
		<!-- ko if: $root.DisplayDescriptions -->
		<span class="label label-default layer-description" data-bind="text: Description"></span>
		<!-- /ko -->
		<!-- /ko -->
	</div>
	<!-- /ko -->
</script>
