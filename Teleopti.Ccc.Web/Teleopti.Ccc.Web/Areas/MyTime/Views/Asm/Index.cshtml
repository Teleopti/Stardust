@using Teleopti.Ccc.Web.Areas.MyTime.Models.Asm
@using Teleopti.Ccc.Web.Core
@model AsmViewModel
@{
	const double pixelsPerHour = 50;
	const double timeLineHourWidth = (pixelsPerHour) - 1; //"1" due to border size
	double canvasStartMsSince1970 = Model.StartDate.SubtractJavascriptBaseDate().TotalMilliseconds;
	const int timeLineMarkerWidth =150;
}
<script type="text/javascript">
	$(function () {
		var serverMsSince1970 = new Date(@(Model.StartDate.Year), @(Model.StartDate.Month - 1), @(Model.StartDate.Day)).getTime();
		var pixelsPerHour = @(pixelsPerHour);


		var currentStart;
		var currentEnd;
		var currentActivity ='';
		var nu = new Date().getTeleoptiTime();
		$('.asm-layer')
			.each(function() {
				var startSpan = $(this).find('.asm-layer-start');
				var endSpan = $(this).find('.asm-layer-end');
				var start = parseFloat(startSpan.attr('milliseconds'));
				var end = parseFloat(endSpan.attr('milliseconds'));
				if(nu >=start && nu <end) {
					currentStart = startSpan.text();
					currentEnd = endSpan.text();
					currentActivity = $(this).find('.asm-layer-activity').text();
					return false;
				}
			});
		if(currentActivity!='') {
			$('#asm-info-current-activity').text(currentActivity);
			$('#asm-info-current-starttime').text(currentStart);
			$('#asm-info-current-endtime').text(currentEnd);
		}

		Teleopti.MyTimeWeb.Asm.Init(serverMsSince1970, pixelsPerHour);
	});
	
</script>

<div class="asm-outer-canvas ui-corner-all">
	<div class="asm-schedule-canvas ui-corner-all">
		<div class="asm-time-marker" style="width:@(timeLineMarkerWidth)px"></div>
		<div class="asm-sliding-schedules" style="width:@(3 * 24 * pixelsPerHour)px;">
			@foreach (var layer in Model.Layers)
			{
				<span class="asm-layer ui-corner-all" style="left:@((layer.StartJavascriptBaseDate - canvasStartMsSince1970) * pixelsPerHour / 60 / 60 / 1000 + @timeLineMarkerWidth)px;
                                                                 	padding-left:@((layer.EndJavascriptBaseDate - layer.StartJavascriptBaseDate) * pixelsPerHour /60 / 60/1000)px;
                                                                 	background-color: @(layer.Color)">
					<span class="asm-layer-start" style="display: none;" milliseconds="@(layer.StartJavascriptBaseDate)">@(layer.StartTimeText)</span>
					<span class="asm-layer-end" style="display: none;" milliseconds="@(layer.EndJavascriptBaseDate)">@(layer.EndTimeText)</span>
					<span class="asm-layer-activity" style="display: none;">@(layer.Payload)</span>
				</span>
			}
			@for (var day = 0; day <= 2; day++)
			{
				for (var hour = 0; hour < 24; hour++)
				{
					<span class="asm-timeline-line" style="width:@(timeLineHourWidth)px;">
						<span class="asm-timeline-number ui-corner-all">@(hour)</span>
					</span>
				}
			}
		</div>
	</div>
	<div class="asm-current-info">
		<div class="asm-info-canvas ui-corner-all">
			<span style="width: 50px;">
				<div>xxDebug</div>
				<div id="asm-info-current-starttime">&nbsp;</div>
				<div>xxNext</div>
			</span>

			<span style="width: 115px;">
				<div id="asm-info-debug">&nbsp;</div>
				<div id="asm-info-current-activity">&nbsp;</div>
				<div id="asm-info-next-activity">&nbsp;</div>			
			</span>
			<span style="width: 40px;">
				<div>&nbsp;</div>
				<div id="asm-info-current-endtime">&nbsp;</div>
				<div>14:30</div>
			</span>
		</div>
		</div>
	  <div class="clearboth" />
</div>
