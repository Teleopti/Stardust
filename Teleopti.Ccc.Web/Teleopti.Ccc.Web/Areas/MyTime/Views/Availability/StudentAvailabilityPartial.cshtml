@using System.Globalization
@using Teleopti.Ccc.UserTexts
@using Teleopti.Ccc.Web.Areas.MyTime.Core
@using Teleopti.Ccc.Web.Areas.MyTime.Models.Portal
@using Teleopti.Ccc.Web.Areas.MyTime.Models.StudentAvailability
@using Teleopti.Interfaces.Domain
@model StudentAvailabilityViewModel
@{
	Layout = null;
}

<div class="navbar">
    <div class="navbar-inner">
        <form class="navbar-form pull-left">
            <div class="input-append input-prepend">
                <button class="btn" data-bind="click: previousPeriod"><i class="icon-arrow-left"></i></button>
                <input data-bind="value: displayDate" type="text" class="span3 text-center" readonly="readonly"/>
                <button class="btn" data-bind="datepicker: selectedDate, datepickerOptions: {autoHide: true}"><i class="icon-th"></i></button>
                <button class="btn" data-bind="click: nextPeriod"><i class="icon-arrow-right"></i></button>
            </div>
        </form>
        <ul class="nav">
            <li class="divider-vertical"></li>
            <li><a href="#" id="Availability-edit-button"><i class="icon-edit"></i>&nbsp;@Resources.Availability</a></li>
            <li><a href="#" id="Availability-delete-button"><i class="icon-remove"></i>&nbsp;@Resources.Remove</a></li>
        </ul>
    </div>
</div>
<div id="Student-availability-edit-form" class="well well-small clearfix" data-bind="visible: AddAvailabilityFormVisible">
    @Html.Partial("AddStudentAvailabilityPartial")
</div>
<div id="StudentAvailability-period" class="alert alert-info">
	@if (Model.StudentAvailabilityPeriod == null)
	{
		@String.Format("{0} : {1}", Resources.StudentAvailabilityPeriod, Resources.MissingWorkflowControlSet)
	}
	else
	{
		@String.Format("{0} : {1} | ", Resources.StudentAvailabilityPeriod, Model.StudentAvailabilityPeriod.Period)
		@String.Format("{0} : {1}", Resources.IsOpen, Model.StudentAvailabilityPeriod.OpenPeriod)
	}
</div>
<div id="StudentAvailability-body" class="clearfix" data-mytime-periodselection='@Html.Schedule().PeriodSelectionAsJson(Model.PeriodSelection)'>
    <style>
        @foreach (var style in Model.Styles)
        {
            @String.Format(".calendarview-week li.{0} div.day-content{{border-left-color: #{1}; border-right-color: #{1};}}\n", style.Name, style.ColorHex)
        }
        </style>
    <div id="StudentAvailability-body-inner" class="well clearfix pd0">
        <ul class="weekdays">
            @foreach (var weekDayName in Model.WeekDayHeaders)
            {
                <li>@weekDayName.Title</li>
            }
        </ul>
        @foreach (var week in Model.Weeks)
        {
            <ul class="calendarview-week">
                <li>
                    <div>
                        <span>@week.Summary.MinWorkTime</span>
                        <span>@week.Summary.MaxWorkTime</span>
                    </div>
                </li>
                @foreach (var day in week.Days)
                {
                    <li data-mytime-editable="@day.Editable" data-mytime-date="@Html.Schedule().FormatDate(day.Date)" class="relative @(day.InPeriod ? "inperiod" : "non-editable")" data-bind="css: {editable: Editable, 'non-editable': !Editable()}">
                        <div>
                            <div class="day-header">
                                <span class="floatleft badge day-header-left day-header-text">@day.Header.DayDescription</span><span class="floatright badge day-header-right day-header-text">@day.Header.DayNumber</span>
                            </div>
                            <div class="day-content pdt10">
                                <img class="loading-small-gray-blue" data-bind="visible: IsLoading" src="@Url.Content("~/Areas/MyTime/Content/Images/ajax-loader-small-f8f8f8.gif")" alt="..." />
                                <!-- ko if: AjaxError().length > 0 -->
                                <h2 class="error" data-bind="text: AjaxError"></h2>
                                <!-- /ko -->
                                <div class="fullwidth mt15 day-content-text" data-bind="text: AvailableTimeSpan">
                                </div>
                            </div>
                        </div>
                    </li>
                }
            </ul>
        }
    </div>
</div>