@using Teleopti.Ccc.UserTexts
@using Teleopti.Ccc.Web.Areas.MyTime.Core
@using Teleopti.Ccc.Web.Areas.MyTime.Models.TeamSchedule
@using Teleopti.Interfaces.Domain
@model TeamScheduleViewModel
@{
	Layout = null;
	const int scheduleWidth = 695;
	var left = Html.HtmlStyleLeft();
}

<div class="navbar navbar-teleopti subnavbar">
	<div class="container">
		<ul class="nav navbar-nav navbar-teleopti row submenu">

			@if (Model.ShiftTradePermisssion)
			{				
				<li class="col-xs-12 col-sm-3">
					<a class="initialize-shift-trade" href="#" data-bind="click: initializeShiftTrade"><i class="glyphicon glyphicon-plus"></i>&nbsp;@Resources.ShiftTradeRequest</a>
				</li>
			}
			<!-- ko if: isShiftTradeBulletinBoardEnabled-->
			@if (Model.ShiftTradeBulletinBoardPermission)
			{
				<li class="col-xs-12 col-sm-3">
					<a class="initialize-shift-trade-bulletin-board" href="#" data-bind="click: initializeShiftTradeBulletinBoard"><i class="glyphicon glyphicon-plus"></i>&nbsp;@Resources.ShiftTradeBulletinBoard</a>
				</li>
				
				<li class="col-xs-12 col-sm-3">
					<a class="initialize-post-shift-for-trade" href="#" data-bind="click: initializePostShiftForTrade"><i class="glyphicon glyphicon-plus"></i>&nbsp;@Resources.AnnounceShift</a>
				</li>
			}
			<!--/ko-->
		</ul>
	</div>
</div>

<div class="container pagebody">
	<div id="teamschedule-body-inner" class="teamschedule-body-inner relative">
		<div id="existsWhenLoadingStarts" data-bind="if: isLocked()"></div>
		<div id="draw-schedule-container" class="well well-sm fixed-non-responsive">
			<div class="row">
				<div class="col-sm-6 col-md-6 col-lg-3">
					<div id="ScheduleDatePicker" class="input-group schedule-filter-component">
						<span class="input-group-btn">
							<button class="previous-date btn" data-bind="click: previousDate, clickable: previousDateValid, enable: previousDateValid">
								<i class="glyphicon glyphicon-chevron-left" data-bind="enable: !isLocked()"></i>
							</button>
						</span>
						<![if (!IE)|(gt IE 8)]>
							<input data-bind="value: requestedDate().format(DatePickerFormat())" style="width: 100%" type="text" class="text-center form-control date-input-style" readonly>
						<![endif]>
						<!--[if lte IE 8]>
							<input type="text" class="col-lg-2 form-control add-shifttrade-datepicker" data-bind="value: requestedDate().format(DatePickerFormat())" readonly="readonly"/>
						<![endif]-->

						<!-- ko if : cultureLoaded -->
						<span class="input-group-btn">
							<button class="btn moment-datepicker" data-bind="datepicker: requestedDate, datepickerOptions: { autoHide: true, weekStart: weekStart() }, enable: !isLoading()">
								<i class="glyphicon glyphicon-calendar"></i>
							</button>
							<button class="next-date btn" data-bind="click: nextDate, clickable: nextDateValid, enable: nextDateValid">
								<i class="glyphicon glyphicon-chevron-right" data-bind="enable: !isLoading()"></i>
							</button>
						</span>
						<!-- /ko -->
					</div>
				</div>
				<!-- ko ifnot: hasError -->
				<div>
					<!-- ko if: showTeamPicker -->
					<div class="col-sm-6 col-md-6 col-lg-3">
						<!-- ko if: showGroupings -->
						<div class="schedule-filter-component">
							<select id="Team-Picker" data-bind="foreach: availableTeams, select2: { value: selectedTeam } ">
								<optgroup data-bind="attr: { label: text }, foreach: children">
									<option data-bind="text: text, value: id"></option>
								</optgroup>
							</select>
						</div>
						<!-- /ko -->
						<!-- ko ifnot: showGroupings-->
						<div class="schedule-filter-component">
							<select id="Team-Picker" data-bind="foreach: availableTeams, select2: { value: selectedTeam } ">
								<option data-bind="text: text, value: id"></option>
							</select>
						</div>
						<!-- /ko -->
					</div>
					<!-- /ko -->
					<!-- ko if: isFilterByTimeEnabled-->
					<div class="col-sm-7 col-md-6 col-lg-4">
						<div class="row">
							<div class="col-xs-6 col-md-6 col-lg-6">
								<div class=" dropdown filter-time-dropdown-button schedule-filter-component" data-bind="click: filterStartEndTimeClick, css:{'filteractived':isStartTimeFilterActived()}">
									<a class="dropdown-toggle btn" data-toggle="dropdown" href="#" style="color: black">
										@Resources.StartTime
										<b class="caret"></b>
									</a>
									<ul class="dropdown-menu filter-time-dropdown-form" role="menu">
										<!-- ko if: isTeamScheduleSortingFeatureEnabled-->
										<li>
											<div class="input-group start-time-sort-order">
												<div class="btn-group" role="group">
													<!-- ko foreach: displaySortOrderTemplateList -->
													<!-- ko if: IsStart -->
													<span data-bind="attr:{class: Description},css:{'sortingbuttonselected': $parent.isSortingTimeActive( $data)}, click : $parent.updateTimeSortOrder, value: Value"></span>
													<!-- /ko -->
													<!-- /ko -->
												</div>
											</div>
										</li>
										<!--/ko-->
										<!-- ko foreach: filterStartTimeList -->
										<li>
											<label class="checkbox filter-time-text">
												<input type="checkbox" data-bind="checked: isChecked">
												<span data-bind="text: text"></span>
											</label>
										</li>
										<!--/ko-->
									</ul>
								</div>
							</div>
							<div class="col-xs-6 col-md-6 col-lg-6">
								<div class="dropdown filter-time-dropdown-button schedule-filter-component" data-bind="click: filterStartEndTimeClick , css:{'filteractived':isEndTimeFilterActived()}">
									<a class="dropdown-toggle btn" data-toggle="dropdown" href="#" style="color: black">
										@Resources.EndTime
										<b class="caret"></b>
									</a>
									<ul class="dropdown-menu filter-time-dropdown-form" role="menu">
										<!-- ko if: isTeamScheduleSortingFeatureEnabled-->
										<li>
											<div class="input-group end-time-sort-order">
												<div class="btn-group" role="group">
													<!-- ko foreach: displaySortOrderTemplateList -->
													<!-- ko if: !IsStart -->
													<span data-bind="attr:{class: Description},css:{'sortingbuttonselected': $parent.isSortingTimeActive( $data)}, click : $parent.updateTimeSortOrder, value: Value"></span>
													<!-- /ko -->
													<!-- /ko -->
												</div>
											</div>
										</li>
										<!--/ko-->
										<!-- ko foreach: filterEndTimeList -->
										<li>
											<label class="checkbox filter-time-text">
												<input type="checkbox" data-bind="checked: isChecked">
												<span data-bind="text: text"></span>
											</label>
										</li>
										<!--/ko-->
										<!-- ko if: filterStartTimeList().slice(-1) -->
										<li data-bind="with: filterStartTimeList().slice(-1)[0]">
											<label class="checkbox filter-time-text">
												<input type="checkbox" data-bind="checked: isChecked">
												<span data-bind="text: text"></span>
											</label>
										</li>
										<!--/ko-->
									</ul>
								</div>
							</div>
						</div>
					</div>
					<!--/ko-->
					<!-- ko if: isTeamScheduleSortingFeatureEnabled-->
					<div class="col-sm-5 col-md-6 col-lg-2">
						<div class="input-group name-search schedule-filter-component">
							<input type="search" class="form-control" placeholder='@Resources.SearchHintForName' data-bind="value: searchNameText, disable: isLocked(), event: { change: changeInSearchBox} " />
							<span class="input-group-addon input-group-addon-narrow">
								<!-- ko if: isLocked -->
								<span class=" glyphicon glyphicon-refresh glyphicon-refresh-animate"></span>
								<!-- /ko -->
								<!-- ko ifnot: isLocked -->
								<span class="glyphicon  glyphicon-search clickable" data-bind="click: changeInSearchBox"></span>
								<!-- /ko -->
							</span>
						</div>
					</div>
					<!--/ko-->
				</div>
				<!--/ko-->
			</div>
			<!-- ko ifnot: hasError -->
			<div class="shift-trade-add-schedule">
				<div class=" shift-trade-timeline">
					<div class="relative">
						<div data-bind="foreach: hours">
							<div class="shift-trade-ruler absolute" data-bind="style: rulerStyleJson, visible: showHourLine"></div>
							<div class="shift-trade-label label label-info absolute" data-bind="style: labelStyleJson, text: hourText, visible: isVisible"></div>
						</div>
					</div>
				</div>
				<table class="responsive" style="width: 100%">
					<thead>
					<tr>
						<td class="shift-trade-agent-name">&nbsp;</td>
						<td></td>
					</tr>
					</thead>
					<!--ko if:isTeamScheduleNoReadModelEnable() -->
					<tbody>
					<tr class="shift-trade-my-schedule-row">
						<td class="shift-trade-agent-name">@Resources.MySchedule</td>
						<td class="shift-trade-my-schedule">
							<div data-bind="foreach: mySchedule().layers">
								<!--ko if:!$parent.mySchedule().isDayOff-->
								<div class="shift-trade-layer-container floatleft">
									<div class="shift-trade-layer add" data-bind="style: styleJson, tooltip: { title: tooltipText, html: true}"></div>
								</div>
								<!--/ko-->
								<!--ko if:$parent.mySchedule().isDayOff-->
								<div class="shift-trade-layer-container floatleft shift-trade-dayoff">
									<div class="dayoff" data-bind="style:$parent.mySchedule().isFullDayAbsence&&{'background-color':backgroundColor},tooltip: $parent.mySchedule().isFullDayAbsence&&{ title: tooltipText, html: true}, text:$parent.mySchedule().dayOffName"></div>
								</div>
								<!--/ko-->
							</div>
							<!--ko if:mySchedule().isDayOff && mySchedule().layers.length == 0-->
							<div class="shift-trade-layer-container floatleft shift-trade-dayoff">
								<div class="dayoff" data-bind="text:mySchedule().dayOffName"></div>
							</div>
							<!--/ko-->
						</td>
					</tr>
					</tbody>
					<tbody data-bind="foreach: toDrawSchedules ">
					<tr class="shift-trade-person-schedule-row agent" data-bind="visible: isVisible">
						<td id="shift-trade-agent-name" class="shift-trade-agent-name floatleft " data-bind="text: $data.agentName, tooltip: { title: $data.agentName, html: true}"></td>
						<td class="shift-trade-possible-trade-schedule">
							<div data-bind="foreach: $data.layers">
								<!--ko if:!$parent.isDayOff-->
								<div class="shift-trade-layer-container floatleft">
									<div class="shift-trade-layer add" data-bind="style: styleJson, tooltip: { title: tooltipText, html: true}"></div>
								</div>
								<!--/ko-->
								<!--ko if:$parent.isDayOff-->
								<div class="shift-trade-layer-container floatleft shift-trade-dayoff">
									<div class="dayoff" data-bind="style:$parent.isFullDayAbsence&&{'background-color':backgroundColor},tooltip: $parent.isFullDayAbsence&&{ title: tooltipText, html: true}, text:$parent.dayOffName"></div>
								</div>
								<!--/ko-->
							</div>
							<!--ko if:isDayOff && layers.length == 0-->
							<div class="shift-trade-layer-container floatleft shift-trade-dayoff">
								<div class="dayoff" data-bind="text:dayOffName"></div>
							</div>
							<!--/ko-->
						</td>
					</tr>
					</tbody>
					<!--/ko-->
					<!--ko if:!isTeamScheduleNoReadModelEnable() -->
					<tbody data-bind="foreach: toDrawSchedules, visiblile:!isTeamScheduleNoReadModelEnable()">
					<tr class="shift-trade-person-schedule-row agent" data-bind="visible: isVisible">
						<td id="shift-trade-agent-name" class="shift-trade-agent-name floatleft " data-bind="text: $data.agentName, tooltip: { title: $data.agentName, html: true}"></td>
						<td class="shift-trade-possible-trade-schedule">
							<div data-bind="foreach: $data.layers">
								<!--ko if:!$parent.isDayOff-->
								<div class="shift-trade-layer-container floatleft">
									<div class="shift-trade-layer add" data-bind="style: styleJson, tooltip: { title: tooltipText, html: true}"></div>
								</div>
								<!--/ko-->
								<!--ko if:$parent.isDayOff-->
								<div class="shift-trade-layer-container floatleft shift-trade-dayoff">
									<div class="dayoff" data-bind="text: titleHeader"></div>
								</div>
								<!--/ko-->
							</div>
						</td>
					</tr>
					</tbody>
					<!--/ko-->
				</table>
			</div>
			<!--/ko-->
			<!-- ko ifnot: hasError -->
			<div style="float: right" data-bind="visible: isPageVisible()">
				<ul class="pagination pagination-sm">
					<li><a data-bind="click: goToFirstPage"><i class="glyphicon glyphicon-fast-backward"></i></a></li>
					<li>
						<a data-bind="click: goPreviousPages, visible: isPreviousMore()">...</a>
					</li>
					<!-- ko foreach: selectablePages() -->
					<li data-bind="css: {'active': $data.isSelected()}">
						<a data-bind="text: $data.index(), click: $parent.selectPage"></a>
					</li>
					<!-- /ko -->
					<li>
						<a data-bind="click: goNextPages, visible: isMore()">...</a>
					</li>
					<li><a data-bind="click: goToLastPage"><i class="glyphicon glyphicon-fast-forward"></i></a></li>

				</ul>
			</div>
			<!--/ko-->
			<!-- ko if: hasError -->
			<div class="alert alert-info bdd-show-message" data-bind="text: errorMessage"></div>
			<!-- /ko -->
			<div class="clearfix"></div>
		</div>
		<div id="existsWhenLoadingFinishes" data-bind="if: !isLoading()"></div>
	</div>
</div>