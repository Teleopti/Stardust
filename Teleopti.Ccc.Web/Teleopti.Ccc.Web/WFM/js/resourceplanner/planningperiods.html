
<div ui-view>
	<div ng-show="scheduleClicked && !schedulingPerformed" class="test-schedule-is-running">
		<md-progress-linear md-mode="indeterminate"></md-progress-linear>
		<p>{{status}}</p>
		<p ng-if="errorMessage">{{errorMessage}}</p>
	</div>

	<!--dont remove test-errorMessage - used to assert in test -->
	<div ng-if="errorMessage" class="test-errorMessage">
		<p>{{errorMessage}}</p>
	</div>
	<div class="view-header">
		<div class="view-title">
			<!--TRANSLATE ME-->
			<h1><i class="mdi mdi-calendar"></i> {{planningPeriod.StartDate | amDateFormat:"L"}} {{'ToText' | translate}} {{planningPeriod.EndDate | amDateFormat:"L"}} 				<i ng-show="initialized" ng-click="changeDateToggle = !changeDateToggle;suggestions(planningPeriod.Id)" class="mdi mdi-pencil searchbaricon update-planning-peroid"><md-tooltip>{{'ChangePlanningPeriod' | translate }}</md-tooltip></i></h1>

			<div class="alert-warning notice-spacer server-busy" ng-if="isScheduleRunning"><i class='mdi mdi-alert'></i>
				<span translate>ScheduleIsRunning</span>
			</div>
			<div ng-if="planningPeriod.State != 'New'" class="text-info schedule-warning" >
				{{'PlanningPeriodIsScheduled' | translate }}
			</div>
			<!-- don't remove non css class test-schedule-is-running - used to assert in test -->
		</div>
	</div>

	<div class="next-planning-peroid">
		<!--dont remove update-planning-peroid - used to assert in test -->
		<div ng-show="!initialized">
			<md-progress-linear md-mode="indeterminate"></md-progress-linear>
			<p>{{'CheckingForecastingRequirements' | translate}}</p>
		</div>

		<div ng-show="initialized">
			<div class="wfm-test-inputContainer" ng-show="changeDateToggle && isEnabled && !planningPeriod.HasNextPlanningPeriod" ng-disabled="rangeDisabled">
				{{'ChangePlanningPeriodTo' | translate}}
				<div ng-repeat="op in suggestedPlanningPeriods">
					<!--dont remove new-planning-period - used to assert in test -->
					<div class="wfm-radio new-planning-period">
						<input type="radio" name="changeRangeGroup" id="{{op.PeriodType}}-{{op.Number}}-{{$index}}" ng-click="rangeUpdated(planningPeriod.Id, op)" />
						<label for="{{op.PeriodType}}-{{op.Number}}-{{$index}}">
							<span class="wfm-radio-toggle"></span>
							<span class="wfm-radio-label new-planning-period"> {{op.StartDate | amDateFormat:"L"}} {{'ToText' | translate}} {{op.EndDate | amDateFormat:"L"}} {{'HavingRangeOf' | translate}} {{op.Number}} {{op.PeriodType}}</span>
						</label>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div ng-show="planningPeriod.Skills.length>0 && planningPeriod.State == 'New'">
		{{'PlanningPeriodMissingMessage' | translate}}
		<p class="text-warning">
			{{'MissingSkills' | translate }}:
			<button class="wfm-btn wfm-btn-default" ng-click="showErrors=!showErrors">show<md-tooltip>Show all errors</md-tooltip></button>
		</p>
	</div>

	<div class="con-row">
		<div class="con-flex">
			<button type="button" name="button" ng-click="createRuleset()" class="wfm-btn wfm-btn-default" translate>NewDayOffRule</button>
			<button class="wfm-btn material-depth-1 wfm-btn-primary" ng-class="{'shrink-in': disableSchedule()}" ng-disabled="disableSchedule()" ng-click="launchSchedule(planningPeriod)">
				{{'ScheduleVerb' | translate }}
			</button>
		</div>
	</div>
	<div class="con-row">
		<div class="con-flex">
			<div class="card-group">
				<div class="panel material-depth-1 filter-boxes" ng-repeat="node in dayoffRules">
					<div class="sub-header">
						<h2>{{node.Name}}</h2>
						<div class="head-actions panel-menu">
							<div tabindex=0 class="context-menu card-context" ng-click="editRuleset(node)">
								<i class=" filter-header mdi mdi-pencil searchbaricon"><md-tooltip>{{'EditFilter' | translate }}</md-tooltip></i>
							</div>
							<div ng-show="!node.Default" tabindex=0 class="context-menu card-context" ng-click="destoryRuleset(node)">
								<i class=" filter-header mdi mdi-delete searchbaricon"><md-tooltip>{{'DeleteFilter' | translate }}</md-tooltip></i>
							</div>

						</div>
					</div>

					<div class="con-row">
						<div class="con-flex">
							<table class="wfm-table wfm-filter-options">
								<thead>
									<tr>
										<th>{{'Settings'|translate}}</th>
										<th>{{'Min'|translate}}</th>
										<th>{{'Max'|translate}}</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td translate>DaysOffPerWeek</td>
										<td>{{node.MinDayOffsPerWeek}}</td>
										<td>{{node.MaxDayOffsPerWeek}}</td>
									</tr>
									<tr>
										<td translate>ConsecutiveWorkDays</td>
										<td>{{node.MinConsecutiveWorkdays}}</td>
										<td>{{node.MaxConsecutiveWorkdays}}</td>
									</tr>
									<tr>
										<td translate>ConsecutiveDaysOff</td>
										<td>{{node.MinConsecutiveDayOffs}}</td>
										<td>{{node.MaxConsecutiveDayOffs}}</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<div class="con-row">
						<div class="con-flex" ng-show="!node.Default">{{'AppliedFilters'|translate}}
							<span class="appliedFilters con-row" ng-repeat="filter in node.Filters">
								<span class="filter-handle">{{filter.FilterType}}</span>
								<span class="filter-chip" >{{filter.Name}}</span>
							</span>
							<span class="moreExists" ng-show="node.Filters.length>5">{{'ThreeDots' | translate}}</span>
						</div>
					</div>
					<div class="con-footer">
						<div class="modal-container" ng-include="'js/resourceplanner/planningperiods-modal.html'"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div ng-show="showErrors">
		<div class="con-row panel">
			<div class="con-flex">
				<ul class="wfm-accordion material-depth-1">
					<li ng-repeat="skill in planningPeriod.Skills">
						<div class="wfm-accordion-head" ng-click="skill.toggle = !skill.toggle">
							{{skill.SkillName}}
							<i ng-class="{'toggle-icon-open':skill.toggle}" class="mdi mdi-chevron-right"></i>
							<span class="pull-right" class="text-muted">{{skill.MissingRanges.length}} {{'IssuesText' | translate }}</span>
						</div>
						<div class="wfm-accordion-content" ng-cloak ng-show="skill.toggle">
							<div ng-repeat="range in skill.MissingRanges">{{'MissingForecastFrom' | translate }} {{range.StartDate | amDateFormat:"L"}} {{'ToText' | translate}} {{range.EndDate | amDateFormat:"L"}}</div>
						</div>
					</li>
				</ul>
			</div>
		</div>
	</div>
</div>
