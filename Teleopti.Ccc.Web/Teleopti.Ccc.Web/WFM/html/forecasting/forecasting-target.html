<div>
	<div ng-if="!showSelection" class="text-center wfm-block">
		<div>
			<md-progress-linear md-mode="indeterminate"></md-progress-linear>
		</div>
	</div>
	<div class="material-block-content" ng-if="showSelection">
		<div class="row ">
			<button class="wfm-btn wfm-btn-default" ng-click="back()">{{ 'Back' | translate }} <md-tooltip>Period selection</md-tooltip> </button>
			<button class="wfm-btn apply pull-right" ng-class="{'wfm-btn-primary-disabled': !hasOneSelected(), 'wfm-btn-primary':hasOneSelected()}" ng-click="nextStep()">{{ 'Apply' | translate }}<md-tooltip>Generate forecast</md-tooltip></button>
			<p>Select forcasting target(s) for period {{period.startDate | date : shortDate}} {{'To' | translate}} {{period.endDate | date : shortDate}}:</p>
		</div>
		<div class="row col-lg-12">
			<div class="tree">
				<div class="angular-ui-tree">
					<ol class="angular-ui-tree-nodes tree-line" ng-model="all">
						<li class="angular-ui-tree-node">
							<div class="tree-toggle-group">
								<div class="toggle-handle" ng-class="{open: all.show}" ng-click="all.show = !all.show"><i class="mdi mdi-chevron-right"></i>
								</div>
								<div class="angular-ui-tree-handle" ng-class="{selected: all.Selected}" ng-click="toggleAll(all.Selected)">
									{{all.Name}} <i class="pull-right total-accuracy"><b ng-if="all.numberOfSelectedWorkloads!==0">{{all.numberOfSelectedWorkloads}}/{{all.totalWorkloads}}</b> {{all.Accuracy}}</i>
								</div>
							</div>
							<ol class="angular-ui-tree-nodes" ng-model="skillsDisplayed" ng-show="all.show">
								<li ng-repeat="skill in skillsDisplayed" class="angular-ui-tree-node" ng-include="'nodes_skill_renderer.html'" value='{{skill.Id}}'></li>
							</ol>
						</li>
					</ol>
				</div>
			</div>
		</div>
	</div>
</div>
<div ng-include="'forecasting-chart.html'" class="forecasting-chart"></div>


<!-- Skill template -->
<script type="text/ng-template" id="nodes_skill_renderer.html">
	<div class="tree-toggle-group">
		<div class="toggle-handle" ng-class="{open: skill.show}" ng-click="skill.show = !skill.show"><i class="mdi mdi-chevron-right"></i></div>
		<div class="angular-ui-tree-handle skill" ng-class="{selected: skill.Selected}" ng-click="toggleSkill(skill)">
			{{skill.Name}}<i class="pull-right skill-accuracy"><b ng-if="skill.numberOfSelectedWorkloads!==0 && skill.numberOfSelectedWorkloads!==skill.Workloads.length">{{skill.numberOfSelectedWorkloads}}/{{skill.Workloads.length}}</b> {{skill.Accuracy}}</i><span><i class="mdi mdi-check"></i></span>
		</div>
	</div>
	<ol class="angular-ui-tree-nodes" ng-model="skill.Workloads" ng-show="skill.show">
		<li ng-repeat="workload in skill.Workloads" class="angular-ui-tree-node" value='{{workload.Id}}'>
			<div class="tree-toggle-group">
				<div class="toggle-handle" ng-class="{open: false}"><i class="mdi mdi-chevron-right ng-hide"></i></div>
				<div ng-class="{selected: workload.Selected || skill.Selected}" class="workload angular-ui-tree-handle" ng-click="toggleWorkload(workload)">
					{{workload.Name}}
					<span><i class="mdi mdi-check"></i></span>
					<i class="mdi mdi-chart-bar forecasting-chart-bar" ng-click="openModal(workload);$event.stopPropagation();">
						<md-tooltip>View method chart</md-tooltip>
					</i>
					<i class="mdi mdi-puzzle forecasting-puzzle" ng-click="goToMethodsView(workload);$event.stopPropagation();" ng-if="isMethodsComparisonViewEnabled">
						<md-tooltip>View methods comparision</md-tooltip>
					</i>
					<i class="mdi mdi-view-day forecasting-view-day" ng-click="goToIntradayPatternView(workload);$event.stopPropagation();" ng-if="isIntradayPatternViewEnabled">
						<md-tooltip>View Intraday pattern</md-tooltip>
					</i>
				</div>
			</div>
		</li>
	</ol>
</script>

<script type="text/ng-template" id="forecasting-chart.html">
	<div ng-cloak class="modal-box">
		<div ng-cloak ng-if="modalInfo.modalLaunch">
			<div class="modalbg">
				<div class="dialog">
					<div class="wfm-slide-tabs">
						<md-content style="padding:0!important;">
							<md-tabs md-dynamic-height md-border-bottom>
								<md-tab label="{{ 'ForecastMethod' | translate }}">
									<md-content class="md-padding">
										<div ng-include="'first-forecast-tab.html'"></div>
									</md-content>
								</md-tab>
								<md-tab label="Queue statistics" ng-if="isQueueStatisticsEnabled">
									<md-content class="md-padding">
										<div ng-include="'second-forecast-tab.html'"></div>
									</md-content>
								</md-tab>
							</md-tabs>
						</md-content>
					</div>
					<div class="modal-footer">
						<aside>
							<a class="wfm-btn wfm-btn-invis-primary" ng-click="cancelMethod()">{{ 'Close' | translate }}</a>
						</aside>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>

<script type="text/ng-template" id="first-forecast-tab.html">
	<div ng-if="modalInfo.evaluationLoading" class="wfm-block">
		<md-progress-linear md-mode="indeterminate"></md-progress-linear>
	</div>
	<div class="alert-warning notice-spacer" ng-show="modalInfo.noHistoricalDataForForecasting"><i class='mdi mdi-alert'></i> Warning: There is no historical data available for forecasting.</div>
	<div ng-if="!modalInfo.evaluationLoading && !modalInfo.noHistoricalDataForForecasting">
		<div class="wfm-block">
			<div class="row">
				<div class="col-lg-12">
					<p>
						This chart shows how well a <i>Forecast Method</i> matches last year's <i>Queue Statistics</i> for workload <i>{{modalInfo.workloadName}}</i>. Out of several tested forecast methods
						this one was the most accurate. <br>The chosen forecast method is based on a period of queue statistics prior to the timeframe in the chart and will be used in the upcoming
						forecast for workload <i>{{modalInfo.workloadName}}</i>.
					</p>
					<div class="row">
						<p>
							We use historical data from <b>{{modalInfo.ForecastMethodRecommended.PeriodUsedToEvaluateStart | date : shortDate}}</b> to <b>{{modalInfo.ForecastMethodRecommended.PeriodUsedToEvaluateEnd | date : shortDate}}</b>, and evaluate forecast methods on the period from <b>{{modalInfo.ForecastMethodRecommended.PeriodEvaluateOnStart | date : shortDate}}</b> to <b>{{modalInfo.ForecastMethodRecommended.PeriodEvaluateOnEnd | date : shortDate}}</b>.
						</p>
					</div>
				</div>
			</div>
		</div>

		<c3chart bindto-id="evaluationChart" chart-data="modalInfo.evaluationChartData" chart-columns="modalInfo.evaluationChartDataColumns" chart-x="modalInfo.dataX" show-subchart="true" style="margin-left:-13px;">
			<chart-axis>
				<chart-axis-x axis-id="date" axis-type="timeseries">
					<chart-axis-x-tick tick-format="%Y-%m-%d" />
				</chart-axis-x>
			</chart-axis>
			<chart-axis>
				<chart-axis-y axis-id="y" axis-position="outer-middle" axis-label="Number of Calls" />
			</chart-axis>
		</c3chart>
	</div>
</script>

<script type="text/ng-template" id="second-forecast-tab.html">
	<div ng-if="modalInfo.queueStatisticsLoading">
		<md-progress-linear md-mode="indeterminate"></md-progress-linear>
	</div>
	<div class="alert-warning notice-spacer" ng-show="modalInfo.noHistoricalDataForForecasting"><i class='mdi mdi-alert'></i> Warning: There is no historical data available for forecasting.</div>
	<div ng-if="!modalInfo.queueStatisticsLoading && !modalInfo.noHistoricalDataForForecasting">
		<div class="wfm-block">
			<div class="row">
				<div class="col-lg-12">
					<p>Queue statistics are shown here</p>
				</div>
			</div>
		</div>
		<c3chart bindto-id="queueStatisticsChart" chart-data="modalInfo.queueStatisticsChartData" chart-columns="modalInfo.queueStatisticsChartDataColumns" chart-x="modalInfo.dataX" show-subchart="true" style="margin-left:-13px;">
			<chart-axis>
				<chart-axis-x axis-id="date" axis-type="timeseries">
					<chart-axis-x-tick tick-format="%Y-%m-%d" />
				</chart-axis-x>
			</chart-axis>
			<chart-axis>
				<chart-axis-y axis-id="y" axis-position="outer-middle" axis-label="Number of Calls" />
			</chart-axis>
		</c3chart>
	</div>
</script>
