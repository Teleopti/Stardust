<section ui-view class="rta-tracer-view" ng-class="{'stop-clear-slap-in-the-face' : vm.displaySlapInTheFace()}">

	<div class="view-header">
		<div class="view-title">
			<h1><i class="mdi mdi-alarm"></i>Rta Tracer - this is an internal troubleshooting tool
			</h1>
			<h2 class="stop-clear-message" ng-if="vm.displaySlapInTheFace()">
				Stop and clear the tracer when done.
			</h2>
		</div>
	</div>

	<div class="con-row">
		<div class="con-flex">
			<div class="panel">
				<div class="con-row">
					<div class="con-flex">
						<label class="input-icon">
							<input style="margin-top: 10px;" ng-model="vm.userCode" type="text">
						</label>
					</div>
					<div class="con-flex">
						<button class="wfm-btn"
								ng-class="vm.displaySlapInTheFace() ? 'wfm-btn-invis-default' : 'wfm-btn-invis-primary'"
								ng-click="vm.trace()">Trace
						</button>
						<button class="wfm-btn"
								ng-class="!vm.displaySlapInTheFace() ? 'wfm-btn-invis-default' : 'wfm-btn-invis-primary'"
								ng-click="vm.stop()">Stop
						</button>
						<button class="wfm-btn"
								title="{{vm.unknownTenantMessage}}"
								ng-class="!vm.displaySlapInTheFace() ? 'wfm-btn-invis-default' : 'wfm-btn-invis-primary'"
								ng-click="vm.clear()">Clear
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<h1>Tracers</h1>
	<div class="con-row">
		<div class="con-flex">
			<div class="panel">
				<table class="wfm-table">
					<tr ng-repeat="tracer in vm.tracers" class="process">
						<td width="200px" style="vertical-align: top">
							{{tracer.process}}<br/>
							{{tracer.tracing}}
						</td>
						<td width="350px" style="vertical-align: top">
							<span ng-repeat="x in tracer.dataReceived">
								<span ng-if="!x.tenant"><a title="{{vm.unknownTenantMessage}}"><b>?</b></a></span>
								Received ({{x.count}}) {{x.by}} {{x.at}}
								<br/>
							</span>
						</td>
						<td width="200px" style="vertical-align: top">
							<span ng-repeat="x in tracer.dataEnqueuing">
								<span ng-if="!x.tenant"><a title="{{vm.unknownTenantMessage}}"><b>?</b></a></span>
								Enqueuing ({{x.count}}) {{x.at}}
								<br/>
							</span>
						</td>
						<td width="200px" style="vertical-align: top">
							<span ng-repeat="x in tracer.dataProcessing">
								<span ng-if="!x.tenant"><a title="{{vm.unknownTenantMessage}}"><b>?</b></a></span>
								Processing ({{x.count}}) {{x.at}}
								<br/>
							</span>
						</td>
						<td width="200px" style="vertical-align: top">
							<span ng-repeat="x in tracer.activityCheck">
								<span ng-if="!x.tenant"><a title="{{vm.unknownTenantMessage}}"><b>?</b></a></span>
								Checked {{x.at}}
								<br/>
							</span>
						</td>
						<td style="vertical-align: top">
							<span ng-repeat="x in tracer.exceptions">
								<span ng-if="!x.tenant"><a title="{{vm.unknownTenantMessage}}"><b>?</b></a></span>
								<a href="" ng-click="x.toggleDisplay()">
									{{x.exception}}
								</a>
								{{x.at}}
								<br/>
							</span>
						</td>
					</tr>
				</table>
			</div>
		</div>
	</div>
	
	<h1 ng-if="vm.exception">Exception</h1>
	<div ng-if="vm.exception" class="con-row">
		<div class="con-flex">
			<div class="panel">
				<div class="con-row">
					<div class="con-flex">
						{{vm.exception}}
					</div>
				</div>
			</div>
		</div>
	</div>

	<div ng-repeat="tracedUser in vm.tracedUsers">
		<h1>{{tracedUser.user}}</h1>
		<div class="con-row">
			<div class="con-flex">
				<div class="panel">
					<table class="wfm-table">
						<tr ng-repeat="state in tracedUser.states" class="trace">
							<td width="200px" style="vertical-align: top">{{state.stateCode}}</td>
							<!-- track by $index cant be tested -->
							<td>
								<span ng-repeat="trace in state.traces track by $index">{{trace}}<br/></span>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>
	</div>

</section>