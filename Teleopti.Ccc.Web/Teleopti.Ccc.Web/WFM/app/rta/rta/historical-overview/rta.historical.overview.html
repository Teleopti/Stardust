<div class="rta-view prototype">
	<div class="view-header with-fab with-desc">
		<div class="view-title">
			<div class="pull-left">
				<h1>
					<i class="mdi mdi-alarm"></i> {{'Adherence'|translate}}
				</h1>
			</div>
			<div class="rta-top-buttons-wrapper pull-left">
				<span>
					<button class="wfm-btn wfm-btn-default" ng-click="vm.goToOverview()">{{'MonitorOrganization'|translate}}</button>
					<button class="wfm-btn wfm-btn-default" ng-click="vm.goToAgents()">{{'MonitorAgents'|translate}}</button>
					<button class="wfm-btn wfm-btn-primary non-pointer">{{'HistoricalAdherence'|translate}}</button>
				</span>
			</div>
		</div>
	</div>

	<div class="panel material-depth-1 con-padding">
		<div class="con-row">
			<div class="con-flex wfm-form organization-picker" outside-click="vm.organizationPickerOpen = false">
				<div class="form-input-wrap">
					<input type="text"
						   placeholder="{{'SelectSitesTeams'|translate}}"
						   ng-click="vm.organizationPickerOpen = !vm.organizationPickerOpen"
						   ng-value="vm.organizationPickerSelectionText"/>
				</div>

				<div style="position: relative">
					<div class="wfm-dropdown-panel panel material-depth-1 full-padding"
						 style="z-index: 999; position: absolute; width: 100%"
						 ng-show="vm.organizationPickerOpen">
						<div class="form-input-wrap filter">
							<input type="text"
								   placeholder="{{'DataFilterThreeDots'|translate}}"
								   ng-model="vm.organizationPickerSearchTerm"/>
						</div>

						<div>
							<button class="wfm-btn wfm-btn-invis-primary"
									ng-class="vm.organizationPickerClearEnabled ? 'wfm-btn-invis-primary' : 'wfm-btn-invis-disabled'"
									ng-click="vm.clearOrganizationSelection()">{{'ClearAll'|translate}}
							</button>
							<button class="wfm-btn wfm-btn-invis-primary"
									ng-class="wfm-btn-invis-primary"
									ng-click="vm.applyOrganizationSelection()">{{'Apply'|translate}}
							</button>
						</div>

						<div ng-repeat="site in vm.sites | filter:vm.organizationPickerSearchTerm">
							<div>
								<span ng-click="site.isExpanded = !site.isExpanded">
									<i class="mdi"
									   ng-class="site.isExpanded ? 'mdi-chevron-up' : 'mdi-chevron-down'"></i>
								</span>
								<md-checkbox style="display: inline-block"
											 ng-checked="site.isChecked"
											 aria-label="Checkbox"
											 ng-class="site.isMarked ? 'marked' : ''"
											 ng-click="site.toggle()">
									<span>{{site.Name}}</span>
								</md-checkbox>
							</div>
							<div style="margin-left: 50px"
								 ng-show="site.isExpanded"
								 ng-repeat="team in site.Teams">
								<md-checkbox ng-checked="team.isChecked"
											 aria-label="Checkbox"
											 ng-click="team.toggle()">
									<span>{{team.Name}}</span>
								</md-checkbox>
							</div>
						</div>

					</div>
				</div>
			</div>

			<div class="con-flex x3">
			</div>
		</div>
	</div>

	<style>
		.rta-view.prototype .cell {
			width: 35px;
			padding: 0;
			position: relative;
		}
		
		.rta-view.prototype .cell .late-for-work-flag {
			background-image: linear-gradient(225deg, orange, orange 5px, transparent 5px, transparent);
			position: absolute;
			z-index: 1;
			height: 7px;
			width: 100%;
		}
		
		.rta-view.prototype .cell .square {
			height: 28px;
			margin: 2px;
			border-radius: .25em;
			padding-top: 4px;
			text-align: center;
		}

		.rta-view.prototype .label.pad.late-for-work{
			background-color: orange;
		}
		
	</style>

	
	<div class="panel material-depth-1" ng-repeat="group in vm.groupings"  style="width: 900px;">
		<div class="card-panel-header-wrapper pointer" ng-click="vm.openCard = !vm.openCard"  style="border-left: 10px solid #66c2ff;background-color: {{vm.ToneAdherencePercentage(group.AdherencePercentage)}}">
			{{group.Name}}&nbsp;&nbsp;<strong>{{group.AdherencePercentage}}%</strong>
		</div>
		<div class="card-panel-content-wrapper" ng-show="vm.openCard">
			<table class="wfm-table">
				<thead>
				<tr>
					<th style="width: 200px; height: 32px">{{'Agent'|translate}}</th>
					<th style="width: 45px; text-align: center" ng-repeat="adherence in group.agentsAdherence[0].Adherence">
						{{adherence.Date}}
					</th>
					<th style="width: 18%">{{'Adherence'|translate}}</th>
					<th>{{'LateForWork'|translate}}</th>
				</tr>
				</thead>
				<tbody>
				<tr  ng-repeat="agent in group.agentsAdherence" style="background-color: transparent">
					<td>{{agent.Name}}</td>
					<td ng-repeat="percentage in agent.Adherence" class="cell">
						<div ng-class="percentage.WasLateForWork ? 'late-for-work-flag': ''"></div>	
					    <div class="square" style="background-color: {{vm.ToneAdherencePercentage(percentage.AdherencePercentage)}}">{{percentage.AdherencePercentage}}</div>
					</td>
					<td>
						<div style="background-color: #f1f1f1; width: 75%; float:left; margin-top:5px">
							<div style="background-color:#3c9ee5; height:10px; width:{{agent.PeriodAdherence.Value}}%"></div>
						</div>
						<div style="width: 10%; margin-left: 6px; float:left;">{{agent.PeriodAdherence.Value}}%</div>
					</td>
					<td>
						<span class="label pad late-for-work">{{agent.LateForWork.Count}}</span>
						<span>{{agent.LateForWork.TotalMinutes}}&nbsp;{{'Minutes'|translate}}</span>
					</td>
				</tr>
				</tbody>
			</table>
		</div>
	</div>

</div>