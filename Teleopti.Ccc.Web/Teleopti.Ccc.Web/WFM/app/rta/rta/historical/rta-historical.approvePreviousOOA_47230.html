<div class="rta-view historical">

	<div class="view-header with-fab with-desc">
		<div class="view-title">
			<h1>
				<i class="mdi mdi-alarm"></i>
				<b>{{vm.agentName}}</b> {{vm.date}}
			</h1>
		</div>
		<div class="fab-wrapper" style="width: 30%">
			<div class="pull-right">
				<a ng-href="{{vm.previousHref}}" style="display: inline-block"
				   class="wfm-btn wfm-btn-default" ng-disabled="!vm.previousHref">
					<md-tooltip ng-if="vm.previousTooltip">{{vm.previousTooltip}}</md-tooltip>
					<i class="mdi mdi-chevron-left"></i>
					{{'Previous' | translate}}
				</a>
				<a ng-href="{{vm.nextHref}}" style="display: inline-block"
				   class="wfm-btn wfm-btn-default" ng-disabled="!vm.nextHref">
					<md-tooltip ng-if="vm.nextTooltip">{{vm.nextTooltip}}</md-tooltip>
					{{'Next' | translate}}
					<i class="mdi mdi-chevron-right"></i>
				</a>
			</div>
		</div>
	</div>

	<div class="panel material-depth-1">
		<div class="twocolumns">
			<div class="left adherence-percent">
				{{'Adherence' | translate}} 60%
			</div>
			<div class="right">
				<div class="timeline">
					<div ng-repeat="row in vm.fullTimeline" class="label label-info"
						 ng-class="time"
						 ng-attr-style="left: {{row.Offset}}">
						{{row.Time | amDateFormat: 'HH.mm'}}
					</div>
				</div>

			</div>
		</div>
		
		<div class="twocolumns">
			<div class="left">
			</div>
			<div class="right">

				<div class="shift">

					<div ng-repeat="outOfAdherence in vm.outOfAdherences"
						 class="out-of-adherence"
						 ng-attr-style="left: {{outOfAdherence.Offset}}; width: {{outOfAdherence.Width}};"
						 data-starttime="{{outOfAdherence.StartTime}}" data-endtime="{{outOfAdherence.EndTime}}">
						<md-tooltip md-direction="top">
							{{outOfAdherence.StartTime}} - {{outOfAdherence.EndTime}}
						</md-tooltip>
					</div>

					<div class="current-time" ng-if="vm.currentTimeOffset"
						 ng-attr-style="left: {{vm.currentTimeOffset}};">
					</div>

					<div ng-repeat="activity in vm.agentsFullSchedule"
						 class="activity"
						 ng-attr-style="width: {{activity.Width}}; left: {{activity.Offset}}; background-color: {{activity.Color}};"
						 data-starttime="{{activity.StartTime | amDateFormat: 'YYYY-MM-DD HH:mm:ss'}}"
						 data-endtime="{{activity.EndTime | amDateFormat: 'YYYY-MM-DD HH:mm:ss'}}">
					</div>

				</div>

			</div>
		</div>
	</div>

	<div class="panel material-depth-1">
		<div class="twocolumns">
			<div class="left">
				{{'Changes' | translate}}
			</div>
			<div class="right">
				<div class="changes">
					<div ng-repeat="diamond in vm.diamonds"
						 ng-class="{'diamond': true, 'highlight': diamond.highlight}" ng-click="diamond.click()"
						 ng-attr-style="left: {{diamond.Offset}}; border-color: {{diamond.RuleColor}}; background-color: {{diamond.RuleColor}}">
					</div>
				</div>
			</div>
		</div>

		<div class="twocolumns">
			<div class="left">
				{{'RecordedOutOfAdherence' | translate}}
			</div>
			<div class="right">
				<div class="recorded-out-of-adherences">
					<div ng-click="outOfAdherence.highlight = !outOfAdherence.highlight"
						 ng-repeat="outOfAdherence in vm.recordedOutOfAdherences"
						 ng-class="{'highlight': outOfAdherence.highlight}"
						 class="recorded-out-of-adherence"
						 ng-attr-style="left: {{outOfAdherence.Offset}}; width: {{outOfAdherence.Width}}">
						<md-tooltip md-direction="top">
							{{outOfAdherence.StartTime}} - {{outOfAdherence.EndTime}}
						</md-tooltip>
					</div>
				</div>
			</div>
		</div>

		<div class="twocolumns">
			<div class="left">
				{{'ApprovedAsInAdherence' | translate}}
			</div>
			<div class="right">
				<div class="approved-periods">
					<div ng-repeat="approved in vm.approvedPeriods"
						 ng-click="approved.highlight = !approved.highlight"
						 class="approved-period"
						 ng-class="{'highlight': approved.highlight}"
						 ng-attr-style="left: {{approved.Offset}}; width: {{approved.Width}}"
						 data-starttime="{{approved.StartTime}}" data-endtime="{{approved.EndTime}}">
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="con-row con-columns">
		<div class="con-flex">
			<rta-card-panel open="vm.openRecordedOutOfAdherences" left-border-color="'#66c2ff'">
				<rta-card-panel-header>
					{{'RecordedOutOfAdherence' | translate}}
				</rta-card-panel-header>
				<rta-card-panel-content>
					<div style="max-height: 300px; overflow-y: scroll">
						<table class="wfm-table">
							<th style="width: 20%">Start</th>
							<th style="width: 20%">End</th>
							<tr ng-repeat="outOfAdherence in vm.recordedOutOfAdherences"
								ng-class="{'highlight': outOfAdherence.highlight}"
								class="recorded-out-of-adherence"
								ng-click="outOfAdherence.highlight = !outOfAdherence.highlight; vm.showApprovePanel(outOfAdherence);">
								<td>
									{{outOfAdherence.StartTime}}
								</td>
								<td>
									{{outOfAdherence.EndTime}}
								</td>
							</tr>
						</table>
					</div>
				</rta-card-panel-content>
			</rta-card-panel>
		</div>

		<div class="con-flex x3">
			<div class="con-row" ng-show="vm.showApprovePanel()" style="margin-bottom: 8px;">
				<div class="con-flex panel material-depth-1" style="padding: 10px">
					<label style="margin-left: 12px">
						Start:
						<input type="time" value="{{vm.approveStartTime}}"
							   style="margin-left: 10px; margin-right: 30px; width: 90px; border:none; border-bottom: 1px solid lightgrey; line-height: 20px"
							   step="2"/>
					</label>
					<label>
						End:
						<input type="time" value="{{vm.approveEndTime}}"
							   style="margin-left: 10px; width: 90px; border:none; border-bottom: 1px solid lightgrey; line-height: 20px"
							   step="2"/>
					</label>
					<button type="button" class="wfm-btn wfm-btn-invis-default">
						Cancel
					</button>
					<button type="submit" class="wfm-btn wfm-btn-invis-primary">
						Approve as in adherence
					</button>
				</div>
			</div>

			<div class="con-row">
				<div class="con-flex">
					<rta-card-panel open="vm.openApprovedPeriods" left-border-color="'#66c2ff'">
						<rta-card-panel-header>
							{{'ApprovedAsInAdherence' | translate}}
						</rta-card-panel-header>
						<rta-card-panel-content>
							<table class="wfm-table">
								<th style="width: 20%">Start</th>
								<th style="width: 20%">End</th>
								<th></th>
								<tr ng-repeat="approved in vm.approvedPeriods"
									ng-class="{'highlight': approved.highlight}"
									ng-click="approved.highlight = !approved.highlight">
									<td>
										{{approved.StartTime}}
									</td>
									<td>
										{{approved.EndTime}}
									</td>
									<td>{{'InAdherence' | translate}}</td>
								</tr>
							</table>
						</rta-card-panel-content>
					</rta-card-panel>
				</div>
			</div>
		</div>
	</div>

	<rta-card-panel ng-repeat="card in vm.cards" open="card.isOpen" left-border-color="card.Color">
		<rta-card-panel-header>{{card.Header}}</rta-card-panel-header>
		<rta-card-panel-content>
			<table class="wfm-table">
				<tr>
					<th style="width: 20%">{{'Time' | translate}}</th>
					<th style="width: 20%">{{'Activity' | translate}}</th>
					<th style="width: 20%">{{'State' | translate}}</th>
					<th style="width: 20%">{{'Rule' | translate}}</th>
					<th style="width: 20%">{{'Adherence' | translate}}</th>
				</tr>
				<tr ng-repeat="item in card.Items"
					class="change"
					ng-class="{'highlight': item.highlight}"
					data-time="{{item.Time | amDateFormat: 'HH:mm:ss'}}"
					ng-click="item.click()">
					<td>
						{{item.Time | amDateFormat: 'HH:mm:ss' }}
					</td>
					<td>
						<span ng-if="item.Activity" class="label" 
							  ng-attr-style="background-color: {{item.ActivityColor}};">
							{{item.Activity}}
						</span>
					</td>
					<td>{{item.State}}</td>
					<td>
						<span ng-if="item.Rule" class="label"
							  ng-attr-style="background-color: {{item.RuleColor}};">
							{{item.Rule}}
						</span>
					</td>
					<td>
						<span ng-if="item.Adherence" class="label"
							  ng-attr-style="background-color: {{item.AdherenceColor}};">
							{{item.Adherence}}
						</span>
					</td>
				</tr>
			</table>
		</rta-card-panel-content>
	</rta-card-panel>
</div>
