<div ng-if="!vm.noWorkloadFound">

  <div class="view-header with-desc with-fab">
    <div class="view-title">
      <h1>
        <i ng-class="vm.getSkillIcon(vm.selectedWorkload.SkillType)">
          <md-tooltip>
            <span ng-if="skill.SkillType.DoDisplayData">{{skill.SkillType.SkillType | translate}}</span>
            <span ng-if="!skill.SkillType.DoDisplayData">{{'UnsupportedSkill' | translate}}</span>
          </md-tooltip>
        </i>
        {{vm.selectedWorkload.Workload.Name}}
        <span ng-if="!vm.selectedWorkload.SkillType.DoDisplayData">({{'UnsupportedSkill' | translate}})</span>
      </h1>
      <p>{{'NewForecastIntro' | translate}}</p>
    </div>
    <div class="fab-wrapper grow-out" ng-if="vm.changesMade && vm.selectedWorkload.SkillType.DoDisplayData">
      <button ng-click="vm.applyWipToScenario()" ng-class="{'shrink-in':vm.savingToScenario}" class="wfm-fab material-depth-1">
        <i ng-cloak class="mdi mdi-content-save"></i>
        <md-tooltip>{{'SaveAsScenario' | translate}}</md-tooltip>
      </button>
    </div>
  </div>

  <div class="con-row">
    <div class="con-flex">
      <div class="panel material-depth-1">
        <div class="con-row">
          <div class="con-flex">
            <div style="display: flex; align-items: center; justify-content:space-between;">
              <label class="inline-flex" style="align-items: center;">
                {{'ScenarioColon'|translate}} &nbsp;
                <md-select ng-model="vm.selectedScenario" ng-change="vm.changeScenario(vm.selectedScenario)" placeholder="{{'Scenario' | translate}}" ng-disabled="vm.savingToScenario || vm.isForecastRunning">
                  <md-option ng-repeat="scenario in vm.scenarios" ng-value="scenario">{{scenario.Name}}</md-option>
                </md-select>
              </label>

              <div>
                <button tabindex=0 class="context-menu card-context" ng-click="vm.periodModal = true" ng-disabled="vm.savingToScenario || vm.isForecastRunning">
                  <i class="mdi mdi-calendar"></i>
                  <md-tooltip>{{'SelectForecastPeriodIntro'|translate}}</md-tooltip>
                </button>
                {{'DateFrom' | translate}}: {{vm.forecastPeriod.startDate | date: L}} {{'DateTo' | translate}}: {{vm.forecastPeriod.endDate  | date: L}}
              </div>

              <div>
                <button tabindex=0 class="context-menu card-context" ng-click="vm.scenarioExportModal = true" ng-disabled="vm.savingToScenario || vm.isForecastRunning">
                  <i class="mdi mdi-share"></i>
                  <md-tooltip>Save to other scenario</md-tooltip>
                </button>

                <button tabindex=0 class="context-menu card-context" ng-click="vm.exportModal = true" ng-disabled="vm.savingToScenario || vm.isForecastRunning">
                  <i class="mdi mdi-file-excel"></i>
                  <md-tooltip>{{'ExportToFile'|translate}}</md-tooltip>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--Override/Campaign-->
  <form ng-submit="vm.applyCampaign()">
    <div class="con-row animate-show" ng-show="vm.campaignPanel" ng-cloak>
      <div class="con-flex">
        <div class="panel material-depth-1">
          <div class="sub-header">
            <h2>{{'Campaign' | translate}}</h2>
          </div>
          <!-- <div class="con-row" ng-if="vm.selectedDayCount.length === 1">
          <div class="con-flex">
          <span>Preview - Original: {{vm.selectedDayCount[0].value | number}}</span>
          <span ng-show="vm.sumOfCallsForSelectedDays">New: {{vm.sumOfCallsForSelectedDays | number}}</span>
        </div>
      </div> -->
      <div class="con-row">
        <div class="con-flex">
          <label for="filter" class="input-icon">
            <i class="mdi mdi-percent">
              <input type="number" ng-change="vm.updateCampaignPreview()" min="-100" required autofocus autocomplete="off" ng-model="vm.campaignPercentage" placeholder="{{'CampaignCallsPercentSign'|translate}}" >
            </i>
          </label>
        </div>
      </div>
      <div class="con-footer">
        <button type="button" class="wfm-btn wfm-btn-invis-default" ng-click="vm.modifyPanelHelper()">{{'Cancel'|translate}}</button>
        <button type="submit" class="wfm-btn wfm-btn-invis-primary">{{'Apply'|translate}}</button>
      </div>
    </div>
  </div>
</div>
</form>

<div class="con-row" ng-show="vm.changesMade && !vm.savingToScenario">
  <div class="con-flex">
    <div class="con-row">
      <div class="con-flex notice-warning">
        <i class="mdi mdi-alert"></i> {{'ThisScenarioHasChanges' | translate}}
      </div>
    </div>
  </div>
</div>

<form ng-submit="vm.applyOverride(form)" class="wfm-form">
  <div class="con-row animate-show" ng-show="vm.overridePanel" ng-cloak>
    <div class="con-flex">
      <div class="panel material-depth-1">
        <div class="sub-header">
          <h2>{{'AbsenceOverride'|translate}}</h2>
        </div>
        <div class="con-row">
          <div class="con-flex">
            <div class="form-input-wrap">
              <label for="nameId">{{'Calls'|translate}}:</label>
              <input type="number" ng-model="form.overrideTasksValue" name="" min="1" value="" autocomplete="off">
            </div>

            <div class="form-input-wrap">
              <label for="nameId">{{'TalkTime'|translate}}:</label>
              <input type="number" ng-model="form.overrideTalkTimeValue" name="" min="1" value="" autocomplete="off">
            </div>

            <div class="form-input-wrap">
              <label for="nameId">{{'ACW'|translate}}:</label>
              <input type="number" ng-model="form.overrideAfterCallWorkValue" name="" min="1" value="" autocomplete="off">
            </div>
          </div>
        </div>
        <div class="con-footer">
          <button type="button" class="wfm-btn wfm-btn-invis-default" ng-click="vm.modifyPanelHelper()">{{'Cancel'|translate}}</button>
          <button type="submit" class="wfm-btn wfm-btn-invis-primary">{{'Apply'|translate}}</button>
        </div>
      </div>
    </div>
  </div>
</form>

<div ng-if="vm.scenarioNotForecasted && !vm.selectedWorkload.SkillType.DoDisplayData">
  <div class="con-row">
    <div class="con-flex">
      <div class="panel material-depth-1">
        <div class="con-row">
          <div class="con-flex">
            This skill is not supported yet. Check back here later to run a forecast for this scenario.
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div ng-if="vm.scenarioNotForecasted && vm.selectedWorkload.SkillType.DoDisplayData">
  <div class="con-row">
    <div class="con-flex">
      <div class="panel material-depth-1">
        <div class="con-row">
          <div class="con-flex">
            There is no forecast data for this scenario, please run a forecast or save from another scenario.
          </div>
        </div>
        <div class="con-footer">
          <button class="wfm-btn wfm-btn-invis-primary" ng-click="vm.forecastModal = true" ng-if="vm.selectedWorkload.SkillType.DoDisplayData" >{{'ForecastDo'|translate}}</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart -->
<div class="con-row" ng-if="vm.isForecastRunning || vm.savingToScenario">
  <div class="con-flex">
    <div class="panel material-depth-1 full-padding">
      <div>
        <span ng-if="vm.isForecastRunning" >{{'RunningForecast'|translate}}</span>
        <span ng-if="vm.savingToScenario" >{{'Saving' | translate}}</span>
        <md-progress-linear md-mode="indeterminate"></md-progress-linear>
      </div>
    </div>
  </div>
</div>

<div class="con-row" ng-if="vm.selectedWorkload.Days.length > 0 && !vm.savingToScenario">
  <div class="con-flex">
    <div class="panel material-depth-1">
      <div class="sub-header">
        <h2>{{'SelectToModify'|translate}}</h2>
        <div class="head-actions panel-menu" >
          <div tabindex=0 ng-show="vm.selectedDayCount.length > 0" class="grow-out context-menu card-context wfm-badge-wrapper">
            <i class="mdi mdi-dots-vertical"></i>
            <wfm-badge badge-model="vm.selectedDayCount.length" pulse="true" status="'notice-success'"> </wfm-badge>
            <span class="context-menu-left">
              <ul class="wfm-list">
                <li ng-if="vm.selectedWorkload.SkillType.DoDisplayData" ng-click="vm.modifyPanelHelper(true)">{{'AbsenceOverride'|translate}}</li>
                <li ng-if="vm.selectedWorkload.SkillType.DoDisplayData" ng-click="vm.modifyPanelHelper(false)">{{'CreateCampaign'|translate}}</li>
                <li ng-if="vm.selectedWorkload.SkillType.DoDisplayData"  ng-click="vm.clearOverride()">{{'ClearOverride'|translate}}</li>
                <li ng-if="vm.selectedWorkload.SkillType.DoDisplayData" ng-click="vm.clearCampaign()">{{'ClearCampaign'|translate}}</li>
                <li ng-click="vm.loadChart(vm.selectedWorkload.ChartId, vm.selectedWorkload.Days)">{{'ClearForecastChart'|translate}}</li>
              </ul>
            </span>
            <md-tooltip>{{ 'Modify' | translate }}</md-tooltip>
          </div>
        </div>
      </div>
      <div class="con-row">
        <div class="con-flex" >
          <forecast-chart chart-id="vm.selectedWorkload.ChartId" selectable="true" refresh="vm.loadChart" on-click="vm.pointClick" days="vm.selectedWorkload.Days"> </forecast-chart>
        </div>
      </div>
      <div class="con-footer">
        <button class="wfm-btn wfm-btn-invis-primary" ng-click="vm.forecastModal = true" ng-if="vm.selectedWorkload.SkillType.DoDisplayData">{{'ForecastDo'|translate}}</button>
      </div>
    </div>
  </div>
</div>


<modal-dialog show='vm.forecastModal' ng-cloak>
  <div>
    <div class="con-row">
      <div class="con-flex">
        <p>{{'TemplateTargetWorkload' | translate}}: <b>{{vm.selectedWorkload.Workload.Name}}</b></p>
        <p class="subtext">{{'Scenario'|translate}}: <b>{{vm.selectedScenario.Name}}</b></p>
      </div>
    </div>

    <div class="modal-inner-content" style="text-align:center;">
      <!-- <label>{{'ForecastPeriod' | translate}}:</label><br/> -->
      <wfm-calendar-picker ng-model="vm.forecastPeriod"></wfm-calendar-picker>
    </div>
    <div class="modal-actions">
      <aside>
        <button class="wfm-btn wfm-btn-invis-primary" ng-disabled="!vm.forecastPeriod.startDate || !vm.forecastPeriod.endDate" ng-click="vm.forecastWorkload()">{{'Apply'|translate}}</button>
      </aside>
    </div>
    <div ng-if="vm.isForecastRunning">
      <md-progress-linear md-mode="indeterminate"></md-progress-linear>
    </div>
  </div>
</modal-dialog>

<modal-dialog show='vm.periodModal' ng-cloak>
  <div>
    <div class="con-row">
      <div class="con-flex">
        <p>{{'TemplateTargetWorkload' | translate}}: <b>{{vm.selectedWorkload.Workload.Name}}</b></p>
        <p class="subtext">{{'Scenario'|translate}}: <b>{{vm.selectedScenario.Name}}</b></p>
      </div>
    </div>

    <div class="modal-inner-content" style="text-align:center;">
      <!-- <label>{{'ForecastPeriod' | translate}}:</label><br/> -->
      <wfm-calendar-picker ng-model="vm.forecastPeriod"></wfm-calendar-picker>
    </div>
    <div class="modal-actions">
      <aside>
        <button class="wfm-btn wfm-btn-invis-primary" ng-disabled="!vm.forecastPeriod.startDate || !vm.forecastPeriod.endDate" ng-click="vm.getWorkloadForecastData()">{{'Apply'|translate}}</button>
      </aside>
    </div>
    <div ng-if="vm.isForecastRunning">
      <md-progress-linear md-mode="indeterminate"></md-progress-linear>
    </div>
  </div>
</modal-dialog>

<modal-dialog show='vm.exportModal' ng-cloak>
  <div>
    <div class="con-row">
      <div class="con-flex">
        <b>{{'ExportToFile'|translate}}</b>
      </div>
    </div>
    <div class="modal-inner-content" style="text-align:center;">
      <wfm-calendar-picker ng-model="vm.forecastPeriod"></wfm-calendar-picker>
    </div>
    <div class="modal-actions">
      <aside>
        <button class="wfm-btn wfm-btn-invis-primary" ng-disabled="!vm.forecastPeriod.startDate || !vm.forecastPeriod.endDate" ng-click="vm.exportToFile()">{{'Export'|translate}}</button>
      </aside>
    </div>
    <div ng-if="vm.isForecastRunning">
      <md-progress-linear md-mode="indeterminate"></md-progress-linear>
    </div>
  </div>
</modal-dialog>

<modal-dialog show='vm.scenarioExportModal' ng-cloak>
  <div>
    <div class="con-row">
      <div class="con-flex">
        <b>Save to other scenario</b>
      </div>
    </div>
    <div class="modal-inner-content">
      select target scenario:
      <md-select ng-model="vm.targetScenario" placeholder="{{'Scenario' | translate}}" ng-disabled="vm.savingToScenario || vm.isForecastRunning">
        <md-option ng-repeat="scenario in vm.scenarios" ng-value="scenario">{{scenario.Name}}</md-option>
      </md-select>
    </div>
    <div class="modal-actions">
      <aside>
        <button class="wfm-btn wfm-btn-invis-primary" ng-click="vm.exportToScenario()">{{'Save'|translate}}</button>
      </aside>
    </div>
    <div ng-if="vm.savingToScenario || vm.isForecastRunning">
      <md-progress-linear md-mode="indeterminate"></md-progress-linear>
    </div>
  </div>
</modal-dialog>


<div ng-cloak
class="modal-box">
<div ng-cloak
ng-show="vm.closeConfirmation">
<div class="modalbg">
  <div class="dialog-mini material-depth-1">
    <div class="modal-inner-content">
      <h3>You have unsaved changes</h3>
      Are you sure you want to exit forecaster without saving?
    </div>
    <div class="modal-actions">
      <aside>
        <button type="button"
        focus-me="vm.closeConfirmation"
        id="confirmExitButton"
        ng-click="vm.changesMade=false; vm.exitConfigMode(); $event.stopPropagation();"
        class="wfm-btn wfm-btn-invis-default">{{'Yes'|translate}}</button>
        <button type="button"
        id="cancelExitButton"
        ng-click="vm.stateName=''; vm.closeConfirmation=false; $event.stopPropagation();"
        class="wfm-btn wfm-btn-invis-primary">{{'No'|translate}}</button>
      </aside>
    </div>
  </div>
</div>
</div>
</div>
</div>
<div ng-cloak ng-if="vm.noWorkloadFound">
  {{'YouHaveToSelectAtLeastOneWorkload'|translate}}
</div>
