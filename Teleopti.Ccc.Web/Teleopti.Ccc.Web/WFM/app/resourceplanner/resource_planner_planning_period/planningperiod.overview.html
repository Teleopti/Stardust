<div class="view-header with-fab with-desc">
	<div class="view-title">
		<h1><i class="mdi mdi-calendar"></i> Schedule Agent Group "{{vm.agentGroup.Name}}"</h1>
		<div class="pp-sub-title">
			<span ng-hide="vm.selectedPp">Select planning period to work with</span>
			<span ng-show="vm.selectedPp">Selected planning period: {{vm.selectedPp.StartDate | amDateFormat:"L"}}-{{vm.selectedPp.EndDate | amDateFormat:"L"}}</span>
			<span ng-if="vm.isDisable() && vm.totalAgents > 0" class="pp-status"> {{vm.status}}</span>
		</div>
	</div>
</div>
<div class="panel material-depth-1 pp-fix" ng-if="vm.show">
	<div class="con-row">
		<div class="con-flex">
			<button class="wfm-btn wfm-btn-default " ng-click="vm.startNextPlanningPeriod()">Create next planning period</button>
			<div ng-if="vm.selectedPp !== null" ng-click="vm.show = false" tabindex=0 class="pull-right context-menu card-context">
				<i class="mdi mdi-close"></i>
			</div>
		</div>
	</div>
	<div class="con-row">
		<div class="con-flex">
			<div class="wfm-grid">
				<div class="grid-card" ng-repeat="p in vm.planningPeriods | orderBy: '-EndDate'">
					<div class="list-content panel" ng-class="{'pp-scheduled':p.State == 'Scheduled'}">
						<div class="ag-pp">
							<div class="con-flex x3 pp-inner-card" ng-click="vm.selectPp(p)">
								<span>
									<i title="Scheduled" ng-if="p.State == 'Scheduled'" class="mdi mdi-calendar-check"></i>
									<i title="Scheduled" ng-if="p.State !== 'Scheduled'" class="mdi mdi-calendar-remove"></i>
									{{p.StartDate | amDateFormat:"L"}}-{{p.EndDate | amDateFormat:"L"}}
								</span>
							</div>
							<div class="con-flex head-actions panel-menu" ng-show="$first">
								<div tabindex=0 class="context-menu card-context">
									<i class="mdi mdi-dots-vertical"></i>
									<div class="context-menu-left">
										<ul class="wfm-list">
											<li ng-click="vm.getLastPp(p); vm.confirmModal1=true; "><i class="mdi mdi-pencil"></i>Edit planning period</li>
											<li ng-hide="vm.planningPeriods.length == 1" ng-click="vm.deleteLastPp(vm.agentGroup.Id)"><i class="mdi mdi-close"></i>Delete planning period</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div ng-if="vm.isDisable() && vm.totalAgents > 0" class="pp-progress test-schedule-is-running">
	<md-progress-linear md-mode="indeterminate"></md-progress-linear>
</div>
<div class="panel material-depth-1 pp-fix" ng-show="vm.selectedPp && !vm.show">
	<div class="wfm-slide-tabs tabbed-panel">
		<div class="head-actions panel-menu">
			<div tabindex=0 class="context-menu card-context">
				<i class="mdi mdi-dots-vertical"></i>
				<span class="context-menu-left">
					<ul class="wfm-list">
						<li ng-click="vm.show = true">Switch planning period</li>
					</ul>
				</span>
			</div>
		</div>
		<md-content class="md-padding">
			<md-tabs md-dynamic-height md-border-bottom>
				<md-tab label="Overview">
					<md-content class="md-padding">
						<div class="con-row">
							<div class="con-flex">
								<button class="wfm-btn material-depth-1" ng-click="vm.launchSchedule(vm.selectedPp)" ng-class="{'wfm-btn-primary-disabled': vm.isDisable(),'wfm-btn-primary':!vm.isDisable()}">{{'ScheduleVerb' | translate }}</button>
								<button class="wfm-btn material-depth-1" ng-click="vm.intraOptimize(vm.selectedPp)" ng-class="{'wfm-btn-primary-disabled': vm.isDisable(),'wfm-btn-primary':!vm.isDisable()}">Intraday Optimize</button>
								<button class="pull-right wfm-btn material-depth-1" ng-click="vm.publishSchedule(vm.selectedPp)" ng-class="{'wfm-btn-primary-disabled': vm.isDisable(), 'wfm-btn-primary':!vm.isDisable()}">Publish</button>
							</div>
						</div>
						<div class="con-row">
							<div class="con-flex result-container">
								<span class="pp-agentnumber" ng-show="vm.dayNodes">
									{{vm.scheduledAgents}}/{{vm.totalAgents}} {{'AgentsSuccessfullyScheduled'|translate}}
								</span>
								<span class="pp-agentnumber" ng-hide="vm.dayNodes">
									{{vm.scheduledAgents}}/{{vm.totalAgents}} agents have been scheduled
								</span>
								<div class="legends" ng-show="vm.dayNodes">
									<span>
										<div class="legend critUnderstaffed"></div>
										{{'CriticalUnderstaffingColon' | translate}}
									</span>
									<span>
										<div class="legend understaffed"></div>
										{{'UnderstaffingColon'|translate}}
									</span>
									<span>
										<div class="legend overstaffed"></div>
										{{'OverstaffingColon'|translate}}
									</span>
									<span>
										<div class="legend closed"></div>
										{{'Closed'|translate}}
									</span>
								</div>
								<div class="grid-scroll-wrap" ng-show="vm.dayNodes.length">
									<table ng-hide="dates.length > 0" class="overview">
										<col width="20px" />
										<tr ng-repeat="(index, subnode) in vm.dayNodes | limitTo:1 ">
											<th class="datehead" ng-repeat="datenode in subnode.SkillDetails">
												<p class="tabledate">{{datenode.Date | amDateFormat:"DD/MM" }}</p>
											</th>
										</tr>
										<tr ng-repeat="(index, subnode) in vm.dayNodes ">
											<td class="skillname">{{ subnode.SkillName }}</td>
											<td class="long" ng-repeat="node in subnode.SkillDetails" ng-class="{weekend: node.weekend}">
												<div class="resourceplanner-box" ng-class="{understaffed:node.ColorId==1,critUnderstaffed:node.ColorId==2,overstaffed:node.ColorId==3, closed: node.ColorId==4}">
													<md-tooltip>
														{{node.Date | amDateFormat:"L"}} - {{subnode.SkillName}}<br/> {{'RelativeDifference' | translate}}: {{node.parseDif}}%
													</md-tooltip>
												</div>
											</td>
										</tr>
									</table>
								</div>
								<div ng-show="vm.dayNodes.length == 0">
									<span><i class="mdi mdi-information-outline"></i> This planning period has no valid schedule result.</span><br/>
								</div>
								<div ng-show="vm.dayNodes == undefined">
									<span><i class="mdi mdi-information-outline"></i> This planning period has no previous schedule result.</span><br/>
									<span ng-show="vm.totalAgents == 0"><i class="mdi mdi-information-outline"></i> There are no agents that can be scheduled in this agent group.</span>
								</div>
							</div>
						</div>
					</md-content>
				</md-tab>
				<md-tab>
					<md-tab-label>
						<span>Validation</span>
						<span class="pp-validation" ng-if="vm.totalValNum > 0">{{vm.totalValNum}}</span>
					</md-tab-label>
					<md-tab-body class="md-padding">
						<div class="con-row" ng-show="vm.preValidation.length == 0 && vm.scheduleIssues.length == 0 ">
							<div class="con-flex">
								<span><i class="mdi mdi-information-outline"></i>There are no validation issues for this planning period.</span>
							</div>
						</div>
						<wfm-card-list multi-select>
							<wfm-card ng-show="vm.preValidation.length > 0" ng-click="vm.validationFilter = ''">
								<card-header tabindex="-1">
									<div tabindex="0">
										<span><i class="mdi"></i>
											Pre-scheduling validation issues
											<div tabindex=0 class="context-menu card-context">
												<i ng-click="vm.getPrevalidationByPpId(vm.selectedPp);$event.stopPropagation();" class="mdi mdi-refresh"></i>
												<md-tooltip>Refresh Pre-scheduling Validation issues</md-tooltip>
											</div>
										</span>
										<span class="chevron"><i class="mdi mdi-chevron-right"></i></span>
										<span class="pull-right">{{vm.totalPreValNum}} issues</span>
									</div>
								</card-header>
								<card-body class="panel">
									<div class="con-row demo-outline">
										<div class="con-flex">
											<div class="con-row">
												<div class="con-flex ">
													<label for="filter" class="input-icon">
														<i class="mdi mdi-filter-outline">
														<input type="text" id="filter" ng-model="vm.validationFilter" placeholder="Filter validation issues">
														<md-tooltip>Filter validation issues</md-tooltip>
														</i>
													</label>
												</div>
												<div class="con-flex"></div>
											</div>
											<table class="wfm-table">
												<thead>
													<tr>
														<th>Issue</th>
														<th>Description</th>
													</tr>
												</thead>
												<tbody>
													<tr ng-repeat="msg in vm.preValidation | filter: vm.validationFilter">
														<td>{{msg.ResourceType}}: {{msg.ResourceName}}</td>
														<td>
															<div ng-repeat="item in msg.ValidationErrors">{{item}}</div>
														</td>
													</tr>
												</tbody>
											</table>
										</div>
									</div>
								</card-body>
							</wfm-card>
							<wfm-card ng-show="vm.scheduleIssues.length > 0">
								<card-header tabindex="-1" ng-click="vm.scheduleIssuesFilter = ''">
									<div tabindex="0">
										<span><i class="mdi"></i>Issues during last scheduling</span>
										<span class="chevron"><i class="mdi mdi-chevron-right"></i></span>
										<span class="pull-right">{{vm.scheduleIssues.length}} issues</span>
									</div>
								</card-header>
								<card-body class="panel">
									<div class="con-row demo-outline">
										<div class="con-flex">
											<div class="con-row">
												<div class="con-flex ">
													<label for="filter" class="input-icon">
														<i class="mdi mdi-filter-outline">
														<input type="text" id="filter" ng-model="vm.scheduleIssuesFilter" placeholder="Filter validation issues">
														<md-tooltip>Filter validation issues</md-tooltip>
														</i>
													</label>
												</div>
												<div class="con-flex"></div>
											</div>
											<table class="wfm-table">
												<thead>
													<tr>
														<th>Issue</th>
														<th>Description</th>
														<!--<th>Issues-Type</th>-->
													</tr>
												</thead>
												<tbody>
													<tr ng-repeat="msg in vm.scheduleIssues | filter: vm.scheduleIssuesFilter">
														<td>Agent: {{msg.Name}}</td>
														<td>{{msg.Message}}</td>
														<!--<td>{{msg.BusinessRuleCategoryText}}</td>-->
													</tr>
												</tbody>
											</table>
										</div>
									</div>
								</card-body>
							</wfm-card>
						</wfm-card-list>
					</md-tab-body>
				</md-tab>
				<md-tab label="Dayoff Rules">
					<md-content class="md-padding">
						<div class="con-row">
							<div dayoff-rules is-disable="vm.isDisableDo" agent-group="vm.agentGroup"></div>
						</div>
					</md-content>
				</md-tab>
				<md-tab label="Info">
					<md-content class="md-padding">
						<div class="con-row">
							<div class="con-flex">
								<div agentgroup-Detail agent-group="vm.agentGroup"></div>
							</div>
						</div>
					</md-content>
				</md-tab>
			</md-tabs>
		</md-content>
	</div>
</div>
<div class="con-row">
	<div class="con-flex pp-modal">
		<div ng-cloak class="modal-box">
			<div ng-cloak ng-show="vm.confirmModal1">
				<div class="modalbg">
					<div class="dialog material-depth-1">
						<div class="modal-inner-content">
							<h3>Edit Planning Period: {{vm.originLastPp.StartDate | amDateFormat:"L"}} - {{vm.originLastPp.EndDate | amDateFormat:"L"}}</h3>
							<div class="con-row">
								<label ng-if="!vm.isEnddateChanged()"><i class="mdi mdi-information-outline"></i> Select a new end date for this planning period.</label>
								<label ng-if="vm.isEnddateChanged()" class="text-warning">
									<i class="mdi mdi-alert"></i> You are going to change the end date of this planning period from {{vm.originLastPp.EndDate | amDateFormat:"L"}} to {{vm.lastPp.endDate | amDateFormat:"L"}}
								</label>
							</div>
							<div class="con-row">
								<date-range-picker class="pp-datepicker" ng-model="vm.lastPp"></date-range-picker>
							</div>
						</div>
						<div class="modal-actions">
							<aside>
								<button ng-click="vm.confirmModal1=false" class="wfm-btn wfm-btn-invis-default">Cancel</button>
								<button ng-class="{'wfm-btn-invis-primary':vm.isEnddateChanged(), 'wfm-btn-invis-disabled': !vm.isEnddateChanged()}" ng-click="vm.confirmModal1=false; vm.changeEndDate();"
								 class="wfm-btn ">Apply</button>
							</aside>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>