<style>
	.agent-row {
		border-bottom: 1px solid rgba(0, 0, 0, 0.12);
		border-left: 3px solid transparent;
	}

	.agent-row:hover {
		background: rgba(0, 0, 0, 0.12);
		border-left: 3px solid #888;
	}

	.person-header {
		background: dodgerblue;
		height: 50%;
		padding: 5px;
		text-align: center;
		color: white;
	}

	.avatar {
		height: 50px;
		width: 50px;
		background: dodgerblue;
		border: 4px solid white;
		color: white;
		line-height: 42px;
		border-radius: 50%;
		text-align: center;
		margin: 0 auto;
		margin-top: 15px;
	}

	.mm,
	.front {
		display: inline-grid;
	}

	.mm {
		z-index: 2;
		opacity: 0.6;
	}

	.front {
		position: relative;
		z-index: 3;
	}

	.x1 {
		transform: translateX(15px) scale(0.8);
		transform-origin: center;
	}

	.x2 {
		transform: translateX(-15px) scale(0.8);
		transform-origin: center;
	}

	.wfm-table td {
		border: none;
	}

	.people-chip-disabled {
		background: rgba(0, 0, 0, 0.26) !important;
		cursor: default;
	}

	.people-checkbox-changed {
		/* margin-bottom: 0;
		border-bottom: 5px solid #0099FF; */
	}
</style>

<div>

	<div class="view-header with-fab with-desc">
		<div class="view-title">
			<h1>
				<i class="mdi mdi-account-multiple"></i> People</h1>
			<p>Search for one or many persons to manage their roles.</p>
		</div>
	</div>
	<div class="con-row">
		<div class="con-flex">
			<div class="panel material-depth-1">
				<div class="sub-header">
					<div class="con-row">
						<div class="con-flex">
							<label for="filter" class="input-icon">
								<i class="mdi mdi-filter-outline">
									<input type="text" id="filter" placeholder="Search person" ng-model="filterInput">
									<md-tooltip>Filter</md-tooltip>
								</i>
							</label>
						</div>
						<!--
						<div class="con-flex">
								<md-select class"mdi" ng-model="model" placeholder="Choose action">
									<md-option ng-repeat="item in demos" ng-value="item.id"><span ng-bind="item.id"></span></md-option>
								</md-select>								
						</div>
					-->
						<div class="con-flex x3">
							<button class="wfm-btn wfm-btn-primary mdi mdi-check" ng-disabled="selectedPeopleIds.length === 0" ng-class="{'wfm-btn-invis-disabled': selectedPeopleIds.length === 0}"
							 ng-click="viewState.showGrant = !viewState.showGrant;">Grant Role</button>
							<button class="wfm-btn wfm-btn-primary mdi mdi-close" ng-disabled="selectedPeopleIds.length === 0" ng-class="{'wfm-btn-invis-disabled': selectedPeopleIds.length === 0}"
							 ng-click="viewState.showRevoke = !viewState.showRevoke">Revoke Role</button>
							<button class="wfm-btn wfm-btn-primary mdi mdi-check" ng-disabled="selectedPeopleIds.length === 0" ng-class="{'wfm-btn-invis-disabled': selectedPeopleIds.length === 0}"
							 ng-click="viewState.showGrantChips = !viewState.showGrantChips">Grant Role (chips)</button>
							<button class="wfm-btn wfm-btn-primary mdi mdi-close" ng-disabled="selectedPeopleIds.length === 0" ng-class="{'wfm-btn-invis-disabled': selectedPeopleIds.length === 0}"
							 ng-click="viewState.showRevokeChips = !viewState.showRevokeChips">Revoke Role (chips)</button>
							<button class="wfm-btn wfm-btn-primary mdi mdi-table-edit" ng-disabled="selectedPeopleIds.length === 0" ng-class="{'wfm-btn-invis-disabled': selectedPeopleIds.length === 0}"
							 ng-click="viewState.showEditRoles = !viewState.showEditRoles; logRoles(roles)">Edit roles</button>
						</div>
					</div>
				</div>
				<div class="con-row">
					<div class="con-flex">
						<div class="con-row">
							<button class="wfm-btn wfm-btn-primary" ng-disabled="selectedPeopleIds.length === 0" ng-class="{'wfm-btn-invis-disabled': selectedPeopleIds.length === 0}"
							 ng-click="resetMulti()">Clear</button>
							<button class="wfm-btn wfm-btn-primary" ng-disabled="selectedPeopleIds.length === 0" ng-click="showAll()">Show selected ({{selectedPeopleIds.length}})</button>
						</div>
						<table class="wfm-table">
							<thead>
								<tr>
									<th>Name</th>
									<th>Roles</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="person in people">
									<td>
										<div tabindex=0 class="context-menu card-context" ng-click="toggleSelectedPerson(person);" ng-class="{'notice-success':isSelectedPerson(person), 'notice-info':!isSelectedPerson(person)}">
											<i class="mdi mdi-account" ng-class="{'mdi-check':isSelectedPerson(person)}"></i>
											<md-tooltip>Select person</md-tooltip>
										</div>
										{{person.FirstName}} {{person.LastName}}
									</td>
									<td>
										{{joinRoleNames(person)}}
									</td>
								</tr>
							</tbody>
						</table>


						<modal-dialog show='viewState.showGrant' ng-cloak>
							<div class="person-header relative">
								<div class="avatar">
									<i class="mdi" ng-class="selectedPeopleIds.length > 1 ? 'mdi-account-multiple' : 'mdi-account'"></i>
								</div>
								<h1 ng-if="selectedPeopleIds.length === 1">Grant roles on {{selectedPeople[0].FirstName}} {{selectedPeople[0].LastName}}</h1>
								<h1 ng-if="selectedPeopleIds.length > 1">Grant roles</h1>
								<h3 ng-if="selectedPeopleIds.length > 1">{{selectedPeopleIds.length}} persons selected</h3>
							</div>
							<div style="margin: 15px;">
								<h2>
									<strong>Current roles</strong>
								</h2>
								<div class="con-fluid-row">
									<div class="con-fluid-flex" ng-repeat="roleId in selectedPeopleRoleIds">
										<div>
											<md-checkbox ng-checked="isRoleOnAllSelected(roleId)" md-indeterminate="!isRoleOnAllSelected(roleId)" ng-disabled="true"
											 aria-label="Checkbox">{{getRole(roleId).Name}}
											</md-checkbox>
										</div>
									</div>
								</div>
								<hr>

								<h2>
									<strong>Available roles</strong>
								</h2>
								<div class="con-fluid-row">
									<div class="con-fluid-flex" ng-repeat="role in roles" ng-if="!isRoleOnAllSelected(role.Id)">
										<md-checkbox ng-model="role.checked" ng-checked="getRoleState(role) === 'checked'" ng-click="toggleRoleState(role)" aria-label="Checkbox"
										 ng-class="roleIsChanged(role) ? 'people-checkbox-changed':''">{{role.Name}}

										</md-checkbox>
									</div>
								</div>
								<div class="modal-actions">
									<aside>
										<button class="wfm-btn wfm-btn-invis" ng-click="close()">Cancel</button>
										<button class="wfm-btn wfm-btn-invis-primary" ng-click="save(true)">Save</button>
									</aside>
								</div>
							</div>
						</modal-dialog>

						<modal-dialog show='viewState.showRevoke' ng-cloak>
							<div class="person-header relative">
								<div class="avatar">
									<i class="mdi" ng-class="selectedPeopleIds.length > 1 ? 'mdi-account-multiple' : 'mdi-account'"></i>
								</div>
								<h1 ng-if="selectedPeopleIds.length == 1">Revoke role on {{selectedPeople[0].FirstName}} {{selectedPeople[0].LastName}}</h1>
								<h1 ng-if="selectedPeopleIds.length > 1">Revoke roles</h1>
								<h3 ng-if="selectedPeopleIds.length > 1">{{selectedPeopleIds.length}} persons selected</h3>
							</div>
							<!--<div ng-controller="MyCtrl">
								{{state}}
								<input type="checkbox" ng-model='state' ng-change='onChange(state)' indeterminate/>
							</div>
							!-->
							<div style="margin: 15px;">
								<h2>
									<strong>Roles to revoke</strong>
								</h2>
								<div class="con-fluid-row">
									<div class="con-fluid-flex" ng-repeat="roleId in selectedPeopleRoleIds">
										<div>
											<md-checkbox ng-checked="false" aria-label="Checkbox">{{getRole(roleId).Name}}
											</md-checkbox>
										</div>
									</div>
								</div>
								<div class="modal-actions">
									<aside>
										<button class="wfm-btn wfm-btn-invis" ng-click="close()">Cancel</button>
										<button class="wfm-btn wfm-btn-invis-primary" ng-click="save(true)">Save</button>
									</aside>
								</div>
							</div>
						</modal-dialog>

						<modal-dialog show='viewState.showEditRoles' ng-cloak>
							<div class="person-header relative">
								<div class="avatar">
									<i class="mdi" ng-class="selectedPeopleIds.length > 1 ? 'mdi-account-multiple' : 'mdi-account'"></i>
								</div>
								<h1 ng-if="selectedPeopleIds.length == 1">Edit roles on {{selectedPeople[0].FirstName}} {{selectedPeople[0].LastName}}</h1>
								<h1 ng-if="selectedPeopleIds.length > 1">Edit roles</h1>
								<h3 ng-if="selectedPeopleIds.length > 1">{{selectedPeopleIds.length}} persons selected</h3>
							</div>
							<!--<div ng-controller="MyCtrl">
								{{state}}
								<input type="checkbox" ng-model='state' ng-change='onChange(state)' indeterminate/>
							</div>
							!-->
							<div style="margin: 15px;">
								<h2>
									<strong>Roles</strong>
								</h2>

								<div class="con-fluid-row">
									<div class="con-fluid-flex" ng-repeat="role in roles">
										<md-checkbox ng-if="selectedPeopleIds.length === 1" ng-model="role.checked" ng-checked="isSelectedRole(role.Id)" ng-change="toggleSelectedRole(role.Id)"
										 aria-label="Checkbox">{{role.Name}}
										</md-checkbox>
										<md-checkbox ng-if="selectedPeopleIds.length > 1" ng-model="role.checked" ng-checked="getRoleState(role) === 'checked'" md-indeterminate="getRoleState(role) === 'intermediate'"
										 ng-click="toggleRoleState(role)" aria-label="Checkbox">{{role.Name}}
										</md-checkbox>
									</div>
								</div>
								<div class="modal-actions">
									<aside>
										<button class="wfm-btn wfm-btn-invis" ng-click="close()">Cancel</button>
										<button class="wfm-btn wfm-btn-invis-primary" ng-click="save(true)">Save</button>
									</aside>
								</div>
							</div>
						</modal-dialog>

						<modal-dialog show='viewState.showGrantChips' ng-cloak>
							<div class="person-header relative">
								<div class="avatar">
									<i class="mdi" ng-class="selectedPeopleIds.length > 1 ? 'mdi-account-multiple' : 'mdi-account'"></i>
								</div>
								<h1 ng-if="selectedPeopleIds.length === 1">Grant roles on {{selectedPeople[0].FirstName}} {{selectedPeople[0].LastName}}</h1>
								<h1 ng-if="selectedPeopleIds.length > 1">Grant roles</h1>
								<h3 ng-if="selectedPeopleIds.length > 1">{{selectedPeopleIds.length}} persons selected</h3>
							</div>
							<div style="margin: 15px;">
								<h2>
									<strong>Current roles</strong>
								</h2>
								<div class="con-fluid-row">
									<div class="con-fluid-flex" ng-repeat="roleId in selectedPeopleRoleIds">
										<div class="wfm-chip-wrap">
											<span class="wfm-chip">
												<span ng-if="isRoleOnAllSelected(roleId)" class="chip-handle people-chip-disabled">
													<i class="mdi mdi-check"></i>
												</span>
												<span ng-if="!isRoleOnAllSelected(roleId)" class="chip-handle people-chip-disabled">
													<i class="mdi mdi-minus"></i>
												</span>
												<span class="chip-text">{{getRole(roleId).Name}}</span>
											</span>
										</div>
									</div>
								</div>
								<hr>
								<h2>
									<strong>Available roles</strong>
								</h2>
								<div class="con-fluid-row">
									<div class="con-fluid-flex" ng-repeat="role in roles" ng-if="!isRoleOnAllSelected(role.Id)">
										<!-- <md-checkbox ng-model="role.checked" ng-checked="isSelectedRole(role.Id)" md-indeterminate="!isSelectedRole(role.Id) && selectedPeopleIds.length > 1 && isUsedBySome(role.Id)"
										 ng-change="toggleSelectedRole(role.Id)" aria-label="Checkbox">{{role.Name}}

										</md-checkbox> -->
										<div class="wfm-chip-wrap">
											<span class="wfm-chip" ng-click="toggleRoleState(role)">
												<!-- <md-checkbox ng-checked="isRoleOnAllSelected(roleId)" md-indeterminate="!isRoleOnAllSelected(roleId)" ng-disabled="true"
													aria-label="Checkbox">{{getRole(roleId).Name}}
												   </md-checkbox> -->
												<span ng-if="getRoleState(role) === 'checked'" class="chip-handle chip-success">
													<i class="mdi mdi-check"></i>
												</span>
												<span ng-if="getRoleState(role) === 'neutral' || getRoleState(role) === 'intermediate'" class="chip-handle">
													<i class="mdi mdi-plus"></i>
												</span>
												<span class="chip-text">{{role.Name}}</span>
											</span>
										</div>

									</div>
								</div>
								<div class="modal-actions">
									<aside>
										<button class="wfm-btn wfm-btn-invis" ng-click="close()">Cancel</button>
										<button class="wfm-btn wfm-btn-invis-primary" ng-click="save(true)">Save</button>
									</aside>
								</div>
							</div>
						</modal-dialog>
						<modal-dialog show='viewState.showRevokeChips' ng-cloak>
							<div class="person-header relative">
								<div class="avatar">
									<i class="mdi" ng-class="selectedPeopleIds.length > 1 ? 'mdi-account-multiple' : 'mdi-account'"></i>
								</div>
								<h1 ng-if="selectedPeopleIds.length === 1">Revoke roles on {{selectedPeople[0].FirstName}} {{selectedPeople[0].LastName}}</h1>
								<h1 ng-if="selectedPeopleIds.length > 1">Revoke roles</h1>
								<h3 ng-if="selectedPeopleIds.length > 1">{{selectedPeopleIds.length}} persons selected</h3>
							</div>
							<div style="margin: 15px;">
								<h2>
									<strong>Roles to revoke</strong>
								</h2>
								<div class="con-fluid-row">
									<div class="con-fluid-flex" ng-repeat="roleId in selectedPeopleRoleIds">
										<div class="wfm-chip-wrap">
											<span class="wfm-chip">
												<span ng-model="revoke" class="chip-handle" ng-class="revoke ? 'chip-error' : ''" ng-click="revoke = !revoke">
													<i class="mdi" ng-class="revoke ? 'mdi-close' : 'mdi-minus'"></i>
												</span>
												<span class="chip-text">{{getRole(roleId).Name}}</span>
											</span>
										</div>
									</div>
								</div>
								<div class="modal-actions">
									<aside>
										<button class="wfm-btn wfm-btn-invis" ng-click="close()">Cancel</button>
										<button class="wfm-btn wfm-btn-invis-primary" ng-click="save(true)">Save</button>
									</aside>
								</div>
							</div>
						</modal-dialog>
					</div>
				</div>
				<div class="con-footer">
					<wfm-pagination class="pull-pagination" pagination-options="paginationOptions" get-data-for-page-callback="getPageData"></wfm-pagination>
				</div>
			</div>
		</div>
	</div>
</div>