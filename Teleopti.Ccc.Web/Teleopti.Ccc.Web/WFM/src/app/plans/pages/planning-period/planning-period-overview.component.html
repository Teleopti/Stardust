<plans-title-bar><i class="mdi mdi-calendar"></i>{{ 'Plans' | translate }}</plans-title-bar>



<div nz-row>
    <nz-spin [nzTip]="status" [nzSpinning]="isDisabled()">
        <button nz-button nzType="default" (click)="launchSchedule()">{{'ScheduleVerb' | translate}}</button>
        <button nz-button nzType="default" (click)="optimizeIntraday()">{{'IntraOptimize' | translate}}</button>
        <button nz-button nzType="default" (click)="clearSchedule()">{{'ClearScheduleResultAndHistoryData' | translate}}</button>
        <button nz-button nzType="default" (click)="publishSchedule()">{{'PublishSchedulePlans' | translate}}</button>
    </nz-spin>
    
    <button nz-button nzType="default" (click)="editPlanningGroup()">{{'PlanGroupScheduling' | translate}}</button>
    
    <nz-tabset>
        <nz-tab nzTitle="{{'Overview'|translate}}">
            <div nz-row>
                <div class="wfm-chip-wrap" *ngIf="valLoading">
                                        <span class="wfm-chip">
                                            <span class="chip-handle chip-error">
                                                ...
                                            </span>
                                            <span class="chip-text">{{'ValidationsAreLoading'|translate}}</span>
                                        </span>
                </div>
                <div class="wfm-chip-wrap" ng-if="!valLoading">
                                            <span class="wfm-chip">
                                                <span class="chip-handle chip-error">
                                                    {{valData.totalValNum}}
                                                </span>
                                                <span class="chip-text">{{'ValidationIssues'|translate}}</span>
                                            </span>
                </div>
                <div class="wfm-chip-wrap">
                                            <span class="wfm-chip">
                                                <span class="chip-handle scheduled-agents">
                                                    {{scheduledAgents}}/{{totalAgents}}
                                                </span>
                                                <span class="chip-text">{{'ScheduledAgents'|translate}}</span>
                                            </span>
                </div>
            </div>

            <div class="grid-scroll-wrap">
                <table class="overview">
                    <!--<col width="20px"/>-->
                    <!--<tr ng-repeat="(index, subnode) in dayNodes | limitTo:1 ">-->
                        <!--<th class="datehead"-->
                            <!--ng-repeat="datenode in subnode.SkillDetails">-->
                            <!--<p class="tabledate">{{datenode.Date }}</p>-->
                        <!--</th>-->
                    <!--</tr>-->
                    <tr *ngFor="let subnode of dayNodes">
                        <td class="skillname">{{ subnode.SkillName }}</td>
                        <td class="long" *ngFor="let node of subnode.SkillDetails"
                            [ngClass]="{weekend: node.weekend}">
                            <div class="resourceplanner-box"
                                 [ngClass]="{understaffed:node.ColorId==1,critUnderstaffed:node.ColorId==2,overstaffed:node.ColorId==3, closed: node.ColorId==4}">
                                <!--<md-tooltip>-->
                                <!--{{'RelativeDifference' | translate}}:-->
                                <!--{{node.parseDif}}% | {{subnode.SkillName}} |-->
                                <!--{{node.Date }}-->
                                <!--</md-tooltip>-->
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </nz-tab>
        <nz-tab [nzTitle]="titleTemplate">
            <ng-template #titleTemplate>
                {{'Validations'|translate}}<nz-badge [nzCount]="valData.totalValNum"></nz-badge>
            </ng-template>
            <div nz-row *ngIf="valData.totalValNum !== 0">
                <nz-collapse>
                    <nz-collapse-panel [nzHeader]="preValidationsTitle">
                        <ng-template #preValidationsTitle>
                            {{'PreSchedulingValidationIssues' | translate}}
                            <span>
                                {{ valData.totalPreValNum }} {{ 'IssuesText' | translate }}
								<button nz-button nzType="default" nzShape="circle"
                                        (click)="loadValidations();$event.stopPropagation();"
                                >
									<i nz-icon type="reload"></i>
								</button>
                            </span>
                        </ng-template>
                        <div nz-row>
                            <div class="con-flex ">
                                <label for="validationFilter" class="input-icon">
                                    <i class="mdi mdi-filter-outline">
                                        <input
                                                type="text"
                                                id="validationFilter"
                                                ng-model="validationFilter"
                                                placeholder="{{'FilterValidationIssues' | translate}}"
                                        />
                                    </i>
                                </label>
                            </div>
                            <table class="wfm-table">
                                <thead>
                                <tr>
                                    <th>{{ 'Resource' | translate }}</th>
                                    <th>{{ 'Area' | translate }}</th>
                                    <th>{{ 'Description' | translate }}</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr *ngFor="let msg of valData.preValidation">
                                    <td>{{ msg.ResourceName }}</td>
                                    <td>
                                        <div *ngFor="let item of msg.ValidationErrors">
                                            {{ item.ResourceType | translate }}
                                        </div>
                                    </td>
                                    <td>
                                        <div *ngFor="let item of msg.ValidationErrors">
                                            {{ item.ErrorMessageLocalized }}
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </nz-collapse-panel>
                    <nz-collapse-panel [nzHeader]="scheduleIssuesTitle">
                        <ng-template #scheduleIssuesTitle>
                            {{'ScheduledIssues' | translate}}
                            <span>
                                {{ valData.totalLastValNum }} {{ 'IssuesText' | translate }}
							</span>
                        </ng-template>
                        <div nz-row>
                            <div class="con-flex ">
                                <label for="scheduleIssuesFilter" class="input-icon">
                                    <i class="mdi mdi-filter-outline">
                                        <input
                                                type="text"
                                                id="scheduleIssuesFilter"
                                                ng-model="scheduleIssuesFilter"
                                                placeholder="{{'FilterValidationIssues' | translate}}"
                                        />
                                    </i>
                                </label>
                            </div>
                            <table class="wfm-table">
                                <thead>
                                <tr>
                                    <th>{{ 'Resource' | translate }}</th>
                                    <th>{{ 'Area' | translate }}</th>
                                    <th>{{ 'Description' | translate }}</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr *ngFor="let msg of valData.scheduleIssues">
                                    <td>{{ msg.ResourceName }}</td>
                                    <td>
                                        <div *ngFor="let item of msg.ValidationErrors">
                                            {{ item.ResourceType | translate }}
                                        </div>
                                    </td>
                                    <td>
                                        <div *ngFor="let item of msg.ValidationErrors">
                                            {{ item.ErrorMessageLocalized }}
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </nz-collapse-panel>
                </nz-collapse>
            </div>
            <div nz-row *ngIf="valData.totalValNum === 0">
                <div>
                    <div nz-row class="panel">
                        <div class="con-flex">
				            <span ng-if="!valLoading">
					            <i class="mdi mdi-information-outline"></i> {{ 'NoValidIssuesForPp' | translate }}</span>
                            <span ng-if="valLoading" class="text-warning">
					            <i class="mdi mdi-alert"></i> Loading validation issues...
				            </span>
                        </div>
                    </div>
                </div>
            </div>
        </nz-tab>
    </nz-tabset>
</div>