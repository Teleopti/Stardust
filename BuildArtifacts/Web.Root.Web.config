<?xml version="1.0"?>
<!--
  For more information on how to configure your ASP.NET application, please visit
  http://go.microsoft.com/fwlink/?LinkId=152368
  -->

<configuration>
	<configSections>
		<sectionGroup name="common">
			<section name="logging" type="Common.Logging.ConfigurationSectionHandler, Common.Logging" />
		</sectionGroup>
		<section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net" />
		<sectionGroup name="elmah">
			<section name="security" requirePermission="false" type="Elmah.SecuritySectionHandler, Elmah" />
			<section name="errorLog" requirePermission="false" type="Elmah.ErrorLogSectionHandler, Elmah" />
			<section name="errorMail" requirePermission="false" type="Elmah.ErrorMailSectionHandler, Elmah" />
			<section name="errorFilter" requirePermission="false" type="Elmah.ErrorFilterSectionHandler, Elmah" />
		</sectionGroup>
		<section name="autofac" type="Autofac.Configuration.SectionHandler, Autofac.Configuration"/>
		<section name="microsoft.identityModel" type="Microsoft.IdentityModel.Configuration.MicrosoftIdentityModelSection, Microsoft.IdentityModel, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
		<sectionGroup name="dotNetOpenAuth" type="DotNetOpenAuth.Configuration.DotNetOpenAuthSection, DotNetOpenAuth.Core">
			<section name="messaging" type="DotNetOpenAuth.Configuration.MessagingElement, DotNetOpenAuth.Core" requirePermission="false" allowLocation="true" />
			<section name="reporting" type="DotNetOpenAuth.Configuration.ReportingElement, DotNetOpenAuth.Core" requirePermission="false" allowLocation="true" />
			<section name="openid" type="DotNetOpenAuth.Configuration.OpenIdElement, DotNetOpenAuth.OpenId" requirePermission="false" allowLocation="true" />
		</sectionGroup>
	</configSections>
	
	<log4net>
		<root>
			<appender-ref ref="EventLogAppender" />
			<appender-ref ref="RollingFileAppender" />
			<level value="ERROR" />
		</root>
		<logger name="Teleopti">
			<level value="WARN" />
		</logger>
		<logger name="DotNetOpenAuth.OpenId">
			<level value="ALL" />
		</logger>
		<appender name="EventLogAppender" type="log4net.Appender.EventLogAppender" >
			<applicationName value="TeleoptiWebApps" />
			<layout type="log4net.Layout.PatternLayout">
				<conversionPattern value="%date [%thread] %-5level %logger [%property{NDC}] - %message%newline" />
			</layout>
		</appender>
		<appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender">
			<file type="log4net.Util.PatternString" value="..\..\Logs\%property{logName}.log" />
			<appendToFile value="true" />
			<rollingStyle value="Size" />
			<maxSizeRollBackups value="10" />
			<maximumFileSize value="100KB" />
			<staticLogFileName value="true" />
			<layout type="log4net.Layout.PatternLayout">
				<conversionPattern value="%date [%thread] %-5level %logger [%property{NDC}] - %message%newline" />
			</layout>
		</appender>
	</log4net>
	<common>
		<logging>
			<factoryAdapter type="Common.Logging.Log4Net.Log4NetLoggerFactoryAdapter, Common.Logging.Log4Net1211">
				<arg key="configType" value="EXTERNAL" />
			</factoryAdapter>
		</logging>
	</common>
  
  <connectionStrings>
	<add name="Queue" connectionString="$(SQL_AUTH_STRING);Initial Catalog=$(DB_ANALYTICS);Application Name=Teleopti.Ccc.Web.SqlQueue"/>
	<add name="Hangfire" connectionString="$(SQL_AUTH_STRING);Initial Catalog=$(DB_ANALYTICS);Application Name=Teleopti.Ccc.Web.Hangfire"/>
		<add name="RtaAnalytics" connectionString="$(SQL_AUTH_STRING);Initial Catalog=$(DB_ANALYTICS);Application Name=Teleopti.Web.RTA.WebService"/>
		<add name="RtaApplication" connectionString="$(SQL_AUTH_STRING);Initial Catalog=$(DB_CCC7);Application Name=Teleopti.Web.RTA.WebService"/>
  </connectionStrings>

	<appSettings file="customTimeoutSettings.config">
		<add key="EnableNewResourceCalculation" value="false"/>	
		<add key="webpages:Version" value="3.0.0.0"/>
		<add key="PreserveLoginUrl" value="true"/>
		<add key="ClientValidationEnabled" value="true"/>
		<add key="UnobtrusiveJavaScriptEnabled" value="true"/>
		<add key="nhibConfPath" value="$(AGENTPORTALWEB_nhibConfPath)" />
		<add key="MessageBroker" value="$(WEB_BROKER_FOR_WEB)"/>
		<add key="MessageBrokerLongPolling" value="true" />
		<add key="ScaleOutBackplaneUrl" value="$(WEB_BROKER_BACKPLANE)"/>
		<add key="DefaultIdentityProvider" value="$(DEFAULT_IDENTITY_PROVIDER)" />
		<add key="MatrixWebSiteUrl" value="$(MATRIX_WEB_SITE_URL)"/>
		<add key="FeatureToggle" value="bin/FeatureFlags/toggles.txt"/>
		<add key="StatsBatchSize" value="20"/>
		<add key="ValidationSettings:UnobtrusiveValidationMode" value="None" />
		<add key="ReportServer" value="$(URL)"/>
		<!--
		TOGGLEMODE
		ALL: All toggles on (except those explicitly set to false)
		RC: RC and true toggles turned on
		[Anything else or not specified]: Used in production. Only toggles set to true turned on
		Change by adding
		<add key="ToggleMode" value="ALL|RC|CUSTOMER" />
		
		Remarked line below must be kept! Used by behavior tests
		-->
		<!--$(TOGGLEMODEAppSetting)-->
		<add key="AuthenticationKey" value="!#¤atAbgT%" />
		<add key="UseRelativeConfiguration" value="$(WEB_DEPLOY)" />
		<add key="UseLocalhostIdentifier" value="$(WEB_DEPLOY)" />
		<add key="CustomEndpointHost" value="$(DNS_ALIAS)" />
		<add key="Hangfire.MSMQ" value="$(HOST_NAME)\PRIVATE$\hangfire-{0}" />
		<add key="ConfigurationFilesPath" value="$(CONFIGURATION_FILES_PATH)" />
		<!--$(PublishEventsToServiceBusAppSetting)-->
	</appSettings>
	<system.serviceModel>
		<serviceHostingEnvironment aspNetCompatibilityEnabled="true"/>
		<services>
			<service name="Teleopti.Ccc.Web.Areas.Rta.TeleoptiRtaService" behaviorConfiguration="Teleopti.Ccc.Rta.WebService.TeleoptiRtaService">
				<!-- Service Endpoints -->
				<endpoint address="" binding="basicHttpBinding" bindingConfiguration="basicHttpBinding_withSize" contract="Teleopti.Ccc.Rta.WebService.ITeleoptiRtaService">
					<!-- 
              Upon deployment, the following identity element should be removed or replaced to reflect the 
              identity under which the deployed service runs.  If removed, WCF will infer an appropriate identity 
              automatically.
          -->
					<identity>
						<dns value="localhost"/>
					</identity>
				</endpoint>
				<endpoint address="mex" binding="$(SDK_SSL_MEX_BINDING)" contract="IMetadataExchange"/>
			</service>
		</services>
		<bindings>
			<basicHttpBinding>
				<binding name="basicHttpBinding_withSize" maxReceivedMessageSize="1000000" maxBufferSize="1000000">
					<security mode="$(SDK_SSL_SECURITY_MODE)">
						<transport clientCredentialType="None" />
					</security>
				</binding>
			</basicHttpBinding>
		</bindings>
		<behaviors>
			<serviceBehaviors>
				<behavior name="Teleopti.Ccc.Rta.WebService.TeleoptiRtaService">
					<!-- To avoid disclosing metadata information, set the value below to false and remove the metadata endpoint above before deployment -->
					<serviceMetadata httpGetEnabled="$(HTTPGETENABLED)" httpsGetEnabled="$(HTTPSGETENABLED)"/>
					<!-- To receive exception details in faults for debugging purposes, set the value below to true.  Set to false before deployment to avoid disclosing exception information -->
					<serviceDebug includeExceptionDetailInFaults="false"/>
                                        <serviceThrottling maxConcurrentCalls="1000" maxConcurrentInstances="1000" maxConcurrentSessions="5000000"/>
				</behavior>
			</serviceBehaviors>
		</behaviors>
	</system.serviceModel>
	<system.web>
		<httpModules>
			<add name="Log4NetModule" type="Teleopti.Ccc.Web.Core.Logging.Log4NetModule, Teleopti.Ccc.Web" />
			<add name="ErrorLog" type="Elmah.ErrorLogModule, Elmah" />
			<add name="ErrorMail" type="Elmah.ErrorMailModule, Elmah" />
			<add name="ErrorFilter" type="Elmah.ErrorFilterModule, Elmah" />
			<add name="WSFederatedAuthenticationModule" type="Teleopti.Ccc.Web.Core.RelativeWSFederationAuthenticationModule, Teleopti.Ccc.Web, Version=7.0.0.0, Culture=neutral"/>
			<add name="SessionAuthenticationModule" type="Microsoft.IdentityModel.Web.SessionAuthenticationModule, Microsoft.IdentityModel, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
		</httpModules>
		<compilation targetFramework="4.5">
			<assemblies>
				<add assembly="System.Web.Abstractions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
				<add assembly="System.Web.Helpers, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
				<add assembly="System.Web.Routing, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
				<add assembly="System.Web.Mvc, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
				<add assembly="System.Web.WebPages, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
				<add assembly="Microsoft.IdentityModel, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
			</assemblies>
		</compilation>
		<authentication mode="None">
			<forms requireSSL="false"></forms>
		</authentication>
		<sessionState mode="Off"></sessionState>
		<pages>
			<namespaces>
				<add namespace="System.Web.Helpers" />
				<add namespace="System.Web.Mvc" />
				<add namespace="System.Web.Mvc.Ajax" />
				<add namespace="System.Web.Mvc.Html" />
				<add namespace="System.Web.Routing" />
				<add namespace="System.Web.WebPages"/>
			</namespaces>
		</pages>
		<globalization culture="auto" uiCulture="auto" />
		<customErrors mode="RemoteOnly" defaultRedirect="~/content/error/error.htm">
			<error statusCode="404" redirect="~/content/error/404.htm"/>
		</customErrors>
		<httpHandlers>
			<add verb="POST,GET,HEAD" path="elmah.axd" type="Elmah.ErrorLogPageFactory, Elmah" />
		</httpHandlers>
		<httpRuntime targetFramework="4.5" requestValidationType="Teleopti.Ccc.Web.Core.AllowTokenPostRequestValidator"/>
		<httpCookies httpOnlyCookies="true" />
		<!--$(MachineKey)-->
	</system.web>
	<system.webServer>
		<validation validateIntegratedModeConfiguration="false"/>
		<modules runAllManagedModulesForAllRequests="true" ><!-- borde vara false! fast problem på win 2008 r2-->
			<remove name="WebDAVModule" />
			<remove name="FormsAuthentication"/>
			<add name="ErrorLog" type="Elmah.ErrorLogModule, Elmah" preCondition="managedHandler" />
			<add name="ErrorMail" type="Elmah.ErrorMailModule, Elmah" preCondition="managedHandler" />
			<add name="ErrorFilter" type="Elmah.ErrorFilterModule, Elmah" preCondition="managedHandler" />
			<add name="Log4NetModule" type="Teleopti.Ccc.Web.Core.Logging.Log4NetModule, Teleopti.Ccc.Web" preCondition="managedHandler"/>
			<add name="SessionAuthenticationModule" type="Microsoft.IdentityModel.Web.SessionAuthenticationModule, Microsoft.IdentityModel, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" preCondition="managedHandler"/>
			<add name="WSFederationAuthenticationModule" type="Teleopti.Ccc.Web.Core.RelativeWSFederationAuthenticationModule, Teleopti.Ccc.Web, Version=7.0.0.0, Culture=neutral" preCondition="managedHandler"/>
		</modules>
		<handlers>
			<remove name="ExtensionlessUrlHandler-ISAPI-4.0_32bit" />
			<remove name="ExtensionlessUrlHandler-ISAPI-4.0_64bit" />
			<remove name="ExtensionlessUrlHandler-Integrated-4.0" />
			<add name="ExtensionlessUrlHandler-Integrated-4.0" path="*." verb="GET,HEAD,POST,DEBUG,DELETE,PUT" type="System.Web.Handlers.TransferRequestHandler" resourceType="Unspecified" requireAccess="Script" preCondition="integratedMode,runtimeVersionv4.0" />
<add name="ExtensionlessUrlHandler-ISAPI-4.0_32bit"
      path="*."
      verb="GET,HEAD,POST,DEBUG,PUT,DELETE"
      modules="IsapiModule"
      scriptProcessor="%windir%\Microsoft.NET\Framework\v4.0.30319\aspnet_isapi.dll"
      preCondition="classicMode,runtimeVersionv4.0,bitness32"
      responseBufferLimit="0" />
<add name="ExtensionlessUrlHandler-ISAPI-4.0_64bit"
      path="*."
      verb="GET,HEAD,POST,DEBUG,PUT,DELETE"
      modules="IsapiModule"
      scriptProcessor="%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet_isapi.dll"
      preCondition="classicMode,runtimeVersionv4.0,bitness64"
      responseBufferLimit="0" />
			<add name="Elmah" path="elmah.axd" verb="POST,GET,HEAD" type="Elmah.ErrorLogPageFactory, Elmah" preCondition="integratedMode" />
		</handlers>
		<httpProtocol>
			<customHeaders>
				<clear />
				<add name="X-UA-Compatible" value="IE=edge" />
				<remove name="Server" />
				<remove name="X-Powered-By" />
				<remove name="X-AspNetMvc-Version" />
				<remove name="X-AspNet-Version" />
			</customHeaders>
		</httpProtocol>
		<staticContent>
			<remove fileExtension=".eot" />
			<remove fileExtension=".ttf" />
			<remove fileExtension=".svg" />
			<remove fileExtension=".woff" />
			<mimeMap fileExtension=".eot" mimeType="application/vnd.ms-fontobject" />
			<mimeMap fileExtension=".ttf" mimeType="application/octet-stream" />
			<mimeMap fileExtension=".svg" mimeType="image/svg+xml" />
			<mimeMap fileExtension=".woff" mimeType="application/font-woff" />
		</staticContent>
	</system.webServer>
	<runtime>
<assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="Common.Logging" publicKeyToken="af08829b84f0328e" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-2.2.0.0" newVersion="2.2.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Castle.Core" publicKeyToken="407dd0808d44fbdc" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-3.3.0.0" newVersion="3.3.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Autofac" publicKeyToken="17863af14b0044da" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-3.5.0.0" newVersion="3.5.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="WebGrease" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-1.5.2.14234" newVersion="1.5.2.14234" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="log4net" publicKeyToken="669e0ddf0bb1aa2a" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-1.2.13.0" newVersion="1.2.13.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Microsoft.Owin" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Microsoft.AspNet.SignalR.Core" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-2.1.2.0" newVersion="2.1.2.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Newtonsoft.Json" publicKeyToken="30ad4fe6b2a6aeed" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-6.0.0.0" newVersion="6.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Microsoft.AspNet.SignalR.Client" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-2.1.2.0" newVersion="2.1.2.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Http" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-4.0.0.0" newVersion="4.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Helpers" publicKeyToken="31bf3856ad364e35" />
        <bindingRedirect oldVersion="1.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.WebPages" publicKeyToken="31bf3856ad364e35" />
        <bindingRedirect oldVersion="0.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Mvc" publicKeyToken="31bf3856ad364e35" />
        <bindingRedirect oldVersion="0.0.0.0-5.2.2.0" newVersion="5.2.2.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Net.Http.Formatting" publicKeyToken="31bf3856ad364e35" />
        <bindingRedirect oldVersion="0.0.0.0-5.2.2.0" newVersion="5.2.2.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Net.Http.Formatting" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-4.0.0.0" newVersion="4.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.WebPages.Deployment" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-2.0.0.0" newVersion="2.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Razor" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.WebPages.Razor" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Http.Owin" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-5.2.2.0" newVersion="5.2.2.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Http" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-5.2.2.0" newVersion="5.2.2.0" />
      </dependentAssembly>
    </assemblyBinding>
	</runtime>
	<microsoft.identityModel>
		<service>
			<audienceUris>
				<add value="http://sample-with-policyengine/" />
				<add value="http://sample-without-policyengine/" />
			</audienceUris>
			<federatedAuthentication>
				<wsFederation passiveRedirectEnabled="false" issuer="$(UrlAuthenticationBridge)" realm="http://sample-with-policyengine/" requireHttps="false" signOutReply="$(URL)" />
				<cookieHandler requireSsl="false" name="FedAuth45" />
			</federatedAuthentication>
			<certificateValidation certificateValidationMode="None" />
			<issuerNameRegistry type="Microsoft.IdentityModel.Tokens.ConfigurationBasedIssuerNameRegistry, Microsoft.IdentityModel, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35">
				<trustedIssuers>
					<add thumbprint="964ff0fb99cb815748f9833a4b0466713483aada" name="AuthBridge.Web" />
				</trustedIssuers>
			</issuerNameRegistry>
		</service>
	</microsoft.identityModel>
	
	<dotNetOpenAuth>
		<messaging>
			<untrustedWebRequest timeout="00:00:30" readWriteTimeout="00:00:10">
				<whitelistHosts>
					<add name="localhost" />
					<add name="$(HOST_NAME)" />
				</whitelistHosts>
			</untrustedWebRequest>
		</messaging>
		<!-- Allow DotNetOpenAuth to publish usage statistics to library authors to improve the library. -->
		<reporting enabled="false" />
		<!-- This is an optional configuration section where aspects of dotnetopenauth can be customized. -->
		<!-- For a complete set of configuration options see http://www.dotnetopenauth.net/developers/code-snippets/configuration-options/ -->
		<openid>
			<provider></provider>
		</openid>
	</dotNetOpenAuth>
</configuration>

